{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "85375f40-a486-498c-83de-df67a5e1c5a5",
   "metadata": {},
   "source": [
    "<table style=\"width:100%; border:none;\">\r\n",
    "    <tr>\r\n",
    "        <td style=\"vertical-align: middle;\">\r\n",
    "            <h1 style=\"margin-bottom:0;\">MySmartMove Dashboard</h1>\r\n",
    "            <p style=\"margin-top:0;\">Créé en mai 2025 par Laura Costa</p>\r\n",
    "        </td>\r\n",
    "        <td style=\"text-align:right; vertical-align: middle;\">\r\n",
    "            <img src=\"logo.jpg\" alt=\"logo\" style=\"height:60px;\">\r\n",
    "        </td>\r\n",
    "    </tr>\r\n",
    "</table>\r\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 426,
   "id": "823bdde2-e192-4c16-97e4-4ae20d6b5f39",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Library import\n",
    "# Standard Library\n",
    "import re\n",
    "import shutil\n",
    "import sys\n",
    "import tempfile\n",
    "import warnings\n",
    "warnings.filterwarnings(\"ignore\")\n",
    "# Data Handling\n",
    "import numpy as np\n",
    "import pandas as pd\n",
    "# Visualization\n",
    "import matplotlib.pyplot as plt\n",
    "import seaborn as sns\n",
    "# Widgets\n",
    "import ipywidgets as widgets\n",
    "# Preprocessing\n",
    "from sklearn.preprocessing import LabelEncoder, StandardScaler, label_binarize\n",
    "# Model Selection\n",
    "from sklearn.model_selection import train_test_split\n",
    "# Models\n",
    "from sklearn.linear_model import LogisticRegression\n",
    "from sklearn.ensemble import RandomForestClassifier\n",
    "# Metrics\n",
    "from sklearn.metrics import (\n",
    "    accuracy_score,\n",
    "    classification_report,\n",
    "    confusion_matrix,\n",
    "    ConfusionMatrixDisplay,\n",
    "    f1_score,\n",
    "    precision_score,\n",
    "    recall_score,\n",
    "    roc_auc_score\n",
    ")\n",
    "# Pipeline\n",
    "from sklearn.pipeline import make_pipeline\n",
    "# Stats\n",
    "from scipy.stats import chi2_contingency\n",
    "import statsmodels.api as sm\n",
    "import statsmodels.formula.api as smf\n",
    "from statsmodels.formula.api import ols\n",
    "# Imbalanced Data Handling\n",
    "from imblearn.over_sampling import RandomOverSampler\n",
    "\n",
    "# Custom palette for histograms\n",
    "custom_palette_sex = {\"F\": \"red\", \"M\": \"blue\"}\n",
    "sns.set(style='whitegrid', palette=\"deep\", font_scale=1.1, rc={\"figure.figsize\": [8, 5]})\n",
    "\n",
    "custom_palette_activity = {\"walk\": \"orange\", \"run\": \"green\"}\n",
    "sns.set(style='whitegrid', palette=\"deep\", font_scale=1.1, rc={\"figure.figsize\": [8, 5]})"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 427,
   "id": "7b7f2de4-b5a4-45f6-8d3c-1ff2bda8f488",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Graphics dashboard\n",
    "\n",
    "# Trainer\n",
    "table_trainer1 = widgets.Output()\n",
    "graph_trainer1 = widgets.Output()\n",
    "\n",
    "# Runner\n",
    "table_runner1 = widgets.Output()\n",
    "table_runner2 = widgets.Output()\n",
    "graph_runner1 = widgets.Output()\n",
    "graph_runner2 = widgets.Output()\n",
    "graph_runner3 = widgets.Output()\n",
    "graph_runner4 = widgets.Output()\n",
    "\n",
    "# Diagnosis\n",
    "table_diagnosis1 = widgets.Output()\n",
    "graph_diagnosis1 = widgets.Output()\n",
    "graph_diagnosis2 = widgets.Output()\n",
    "graph_diagnosis3 = widgets.Output()\n",
    "graph_diagnosis4 = widgets.Output()\n",
    "\n",
    "# Session\n",
    "graph_session1 = widgets.Output()\n",
    "graph_session2 = widgets.Output()\n",
    "graph_session3 = widgets.Output()\n",
    "\n",
    "# kinectics\n",
    "graph_kinetics1 = widgets.Output()\n",
    "graph_kinetics2 = widgets.Output()\n",
    "graph_kinetics3 = widgets.Output()\n",
    "graph_kinetics4 = widgets.Output()\n",
    "graph_kinetics5 = widgets.Output()\n",
    "graph_kinetics6 = widgets.Output()\n",
    "graph_kinetics7 = widgets.Output()\n",
    "graph_kinetics8 = widgets.Output()\n",
    "graph_kinetics9 = widgets.Output()\n",
    "graph_kinetics10 = widgets.Output()\n",
    "\n",
    "# spatio-temporal\n",
    "graph_spatio1 = widgets.Output()\n",
    "graph_spatio2 = widgets.Output()\n",
    "graph_spatio3 = widgets.Output()\n",
    "graph_spatio4 = widgets.Output()\n",
    "graph_spatio5 = widgets.Output()\n",
    "\n",
    "# pelvis\n",
    "graph_pelvis1 = widgets.Output()\n",
    "graph_pelvis2 = widgets.Output()\n",
    "graph_pelvis3 = widgets.Output()\n",
    "graph_pelvis4 = widgets.Output()\n",
    "graph_pelvis5 = widgets.Output()\n",
    "graph_pelvis6 = widgets.Output()\n",
    "graph_pelvis7 = widgets.Output()\n",
    "graph_pelvis8 = widgets.Output()\n",
    "graph_pelvis9 = widgets.Output()\n",
    "graph_pelvis10 = widgets.Output()\n",
    "\n",
    "# hips\n",
    "graph_hips1 = widgets.Output()\n",
    "graph_hips2 = widgets.Output()\n",
    "graph_hips3 = widgets.Output()\n",
    "graph_hips4 = widgets.Output()\n",
    "graph_hips5 = widgets.Output()\n",
    "graph_hips6 = widgets.Output()\n",
    "graph_hips7 = widgets.Output()\n",
    "graph_hips8 = widgets.Output()\n",
    "graph_hips9 = widgets.Output()\n",
    "graph_hips10 = widgets.Output()\n",
    "graph_hips11 = widgets.Output()\n",
    "graph_hips12 = widgets.Output()\n",
    "graph_hips13 = widgets.Output()\n",
    "graph_hips14 = widgets.Output()\n",
    "graph_hips15 = widgets.Output()\n",
    "graph_hips16 = widgets.Output()\n",
    "graph_hips17 = widgets.Output()\n",
    "graph_hips18 = widgets.Output()\n",
    "graph_hips19 = widgets.Output()\n",
    "graph_hips20 = widgets.Output()\n",
    "graph_hips21 = widgets.Output()\n",
    "graph_hips22 = widgets.Output()\n",
    "graph_hips23 = widgets.Output()\n",
    "graph_hips24 = widgets.Output()\n",
    "\n",
    "\n",
    "# knee\n",
    "graph_knee1 = widgets.Output()\n",
    "graph_knee2 = widgets.Output()\n",
    "graph_knee3 = widgets.Output()\n",
    "graph_knee4 = widgets.Output()\n",
    "graph_knee5 = widgets.Output()\n",
    "graph_knee6 = widgets.Output()\n",
    "graph_knee7 = widgets.Output()\n",
    "graph_knee8 = widgets.Output()\n",
    "graph_knee9 = widgets.Output()\n",
    "graph_knee10 = widgets.Output()\n",
    "graph_knee11 = widgets.Output()\n",
    "graph_knee12 = widgets.Output()\n",
    "graph_knee13 = widgets.Output()\n",
    "graph_knee14 = widgets.Output()\n",
    "graph_knee15 = widgets.Output()\n",
    "graph_knee16 = widgets.Output()\n",
    "graph_knee17 = widgets.Output()\n",
    "graph_knee18 = widgets.Output()\n",
    "graph_knee19 = widgets.Output()\n",
    "graph_knee20 = widgets.Output()\n",
    "graph_knee21 = widgets.Output()\n",
    "graph_knee22 = widgets.Output()\n",
    "graph_knee23 = widgets.Output()\n",
    "graph_knee24 = widgets.Output()\n",
    "\n",
    "\n",
    "# correlation\n",
    "graph_correlation1 = widgets.Output()\n",
    "graph_correlation2 = widgets.Output()\n",
    "graph_correlation3 = widgets.Output()\n",
    "correlation1 = widgets.Output()\n",
    "correlation2 = widgets.Output()\n",
    "correlation3 = widgets.Output()\n",
    "\n",
    "# statistics\n",
    "table_stats1= widgets.Output()\n",
    "content_stats1 = widgets.Output()\n",
    "graph_stats1 = widgets.Output()\n",
    "graph_stats2 = widgets.Output()\n",
    "graph_stats3 = widgets.Output()\n",
    "graph_stats4 = widgets.Output()\n",
    "graph_stats5 = widgets.Output()\n",
    "graph_stats6 = widgets.Output()\n",
    "graph_stats7 = widgets.Output()\n",
    "graph_stats8 = widgets.Output()\n",
    "graph_stats9 = widgets.Output()\n",
    "graph_stats10 = widgets.Output()\n",
    "graph_stats11 = widgets.Output()\n",
    "graph_stats12 = widgets.Output()\n",
    "graph_stats13 = widgets.Output()\n",
    "graph_stats14 = widgets.Output()\n",
    "graph_stats15 = widgets.Output()\n",
    "graph_stats16 = widgets.Output()\n",
    "graph_stats17 = widgets.Output()\n",
    "graph_stats18 = widgets.Output()\n",
    "graph_stats19 = widgets.Output()\n",
    "graph_stats20 = widgets.Output()\n",
    "graph_stats21 = widgets.Output()\n",
    "graph_stats22 = widgets.Output()\n",
    "graph_stats23 = widgets.Output()\n",
    "graph_stats24 = widgets.Output()\n",
    "graph_stats25 = widgets.Output()\n",
    "graph_stats26 = widgets.Output()\n",
    "graph_stats27 = widgets.Output()\n",
    "graph_stats28 = widgets.Output()\n",
    "graph_stats29 = widgets.Output()\n",
    "graph_stats30 = widgets.Output()\n",
    "graph_stats31 = widgets.Output()\n",
    "graph_stats32 = widgets.Output()\n",
    "graph_stats33 = widgets.Output()\n",
    "graph_stats34 = widgets.Output()\n",
    "graph_stats35 = widgets.Output()\n",
    "graph_stats36 = widgets.Output()\n",
    "\n",
    "# ML\n",
    "ml1 = widgets.Output()\n",
    "ml2 = widgets.Output()\n",
    "ml3 = widgets.Output()\n",
    "ml4 = widgets.Output()\n",
    "ml5 = widgets.Output()\n",
    "ml6 = widgets.Output()\n",
    "ml7 = widgets.Output()\n",
    "ml8 = widgets.Output()\n",
    "\n",
    "#about\n",
    "version = widgets.Output()\n",
    "with version:\n",
    "    display(f\"Version de Python : {sys.version}\")\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 428,
   "id": "1de93516-189d-4122-b911-faf6d2a552ba",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Useful functions for further analysis\n",
    "\n",
    "# Function to remove spaces and lowercase name and surname\n",
    "def normalize_name(name):\n",
    "    \"param : string\"\n",
    "    \"return : string\"\n",
    "    return re.sub(r'[\\s\\-]', '', name.strip().lower())\n",
    "\n",
    "# Function to lowercase emails and remove trailing digits\n",
    "def normalize_email(email):\n",
    "    email = email.lower()\n",
    "    email = re.sub(r'\\d+$', '', email)\n",
    "    return email\n",
    "    \n",
    "\n",
    "#Function to remplace values <0 by the average of the sample\n",
    "def replace_negative_values_by_mean (df, column) :\n",
    "    \"param : DataFrame pandas, column name (str)\"\n",
    "    \"return : DataFrame pandas with negatives values replaced\"\n",
    "\n",
    "    mean= round( df [df[column]>=0][column].mean(),2)\n",
    "    df[column]=df[column].apply (lambda x: mean if x <0 else x)\n",
    "    return df\n",
    "\n",
    "#Symmetry\n",
    "def ComputeSymmetryStep(right_value, left_value):\n",
    "    \"param : right_value (float): Value from the right side,  left_value (float): Value from the left side\"\n",
    "    \"return : symmetryIndex (float)\"\n",
    "    norm = 0.5*(np.abs(right_value) + np.abs(left_value))\n",
    "    symmetryIndex = 100 * (1 - np.abs(right_value - left_value) / norm)\n",
    "    return symmetryIndex\n",
    "\n",
    "def ComputeSymmetryPeak(right_value, left_value, activity, weight):\n",
    "    \"param : right_value (float): Value from the right side,  leftParameter (float): Value from the left side, run or walk\"\n",
    "    \"param : weight (float)\"\n",
    "    \"return : symmetryIndex (float)\"\n",
    "    if activity == \"walk\":\n",
    "        divisor = 3 * weight\n",
    "    elif activity == \"run\":\n",
    "        divisor = 8 * weight\n",
    "    symmetryIndex = 100 * (1 - abs(right_value - left_value) / divisor)\n",
    "    return round(symmetryIndex,0)\n",
    "\n",
    "def ComputeSymmetryVlr(right_value, left_value, activity):\n",
    "    \"param : right_value(float): Value from the right side,  left_value(float): Value from the left side run or walk\"\n",
    "    \"return : symmetryIndex (float)\"\n",
    "    if activity == \"walk\":\n",
    "        divisor = 30\n",
    "    elif activity == \"run\":\n",
    "        divisor = 150\n",
    "    symmetryIndex = 100 * (1 - abs(right_value - left_value) / divisor)\n",
    "    return round(symmetryIndex, 0)\n",
    "\n",
    "def ComputeSymmetryPelvis(min_value, max_value):\n",
    "    \"param : min_value (float): minimal value,  max_value (float): maximum value\"\n",
    "    \"return : symmetryIndex (float)\"\n",
    "    symmetryIndex = 100 * (1 - abs(min_value + max_value) / 20)\n",
    "    return round(symmetryIndex, 0)\n",
    "\n",
    "def ComputeSymmetryHipKnee (value1, value2, divisor):\n",
    "    \"param : value1 (float), value2 (float)\"\n",
    "    \"param : divisor (float)\"\n",
    "    \"return : symmetryIndex (float)\"\n",
    "    symmetryIndex = 100 * (1 - np.abs(value1-value2)/divisor)\n",
    "    return symmetryIndex\n",
    "\n",
    "# Export to Excel\n",
    "export_button1 = widgets.Button(description=\"Exporter le jeu de données non nettoyé\")\n",
    "def export_to_excel1(b):\n",
    "    file_path = \"Dataset_without_cleaning.xlsx\"\n",
    "    dataset_without_cleaning.to_excel(file_path, index=False, engine=\"openpyxl\")\n",
    "export_button1.on_click(export_to_excel1)\n",
    "\n",
    "export_button2 = widgets.Button(description=\"Exporter le jeu de données nettoyé\")\n",
    "def export_to_excel2(b):\n",
    "    file_path = \"Dataset_cleaned.xlsx\"\n",
    "    dataset_cleaned.to_excel(file_path, index=False, engine=\"openpyxl\")\n",
    "export_button2.on_click(export_to_excel2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 429,
   "id": "99158214-256d-48c6-b666-781dba18856b",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Data import: load data from 5 CSV files\n",
    "# - trainers : general information about the trainers\n",
    "# - runners: general information about the runners\n",
    "# - session: session data\n",
    "# - ang_parameters: pelvis, hips, knees (export .csv in phyMyAdmin then convert in xlsx)\n",
    "# - stride_parameters: spatial and temporal parameters\n",
    "df_trainer=pd.read_csv(\"trainer.csv\", sep=\";\", encoding =\"latin\")\n",
    "df_runner=pd.read_csv(\"runner.csv\", sep= \";\", encoding=\"latin\")\n",
    "df_session=pd.read_csv(\"session.csv\", sep =\";\", encoding=\"latin\")\n",
    "df_stride_parameters=pd.read_csv(\"stride_parameters.csv\", sep=\";\", encoding =\"latin\")\n",
    "df_ang_parameters=pd.read_excel(\"ang_parameters.xlsx\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 430,
   "id": "046422b1-db5d-4b24-89e8-92add144e406",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Data cleaning : trainers\n",
    "# - Rename id column to trainer_id\n",
    "# - Rename created_at to trainer_created_at\n",
    "# - Drop irrelevant columns : password, public_id\n",
    "df_trainer_preprocessed=df_trainer.copy()\n",
    "df_trainer_preprocessed=df_trainer_preprocessed.rename(columns={\"id\":\"trainer_id\"})\n",
    "df_trainer_preprocessed=df_trainer_preprocessed.drop(columns=[\"password\", \"public_id\"])\n",
    "df_trainer_preprocessed=df_trainer_preprocessed.rename(columns={\"created_at\":\"trainer_created_at\"})\n",
    "\n",
    "# - Delete lines where trainer = trainer 1 or 2 (id_trainer = 1 and id_trainer=2)\n",
    "# - Delete lines where trainer = developer (trainer_id from 34 to 44)\n",
    "# - Delete duplicates\n",
    "df_trainer_cleaned=df_trainer_preprocessed\n",
    "df_trainer_cleaned= df_trainer_cleaned[df_trainer_cleaned['trainer_id'] >= 3]\n",
    "df_trainer_cleaned = df_trainer_cleaned[~df_trainer_cleaned['trainer_id'].between(34, 44)]\n",
    "df_trainer_cleaned=df_trainer_cleaned.drop_duplicates()\n",
    "\n",
    "# Grouping of duplicates by e-mail address, surname and first name\n",
    "# - Standardize trainer data (last name, first name, e-mail) : 2 functions normalize_email and normalize_name\n",
    "# - Delete lines where email adress contains \"mysmartmove\", \"gelin\" or \"laffet\"\n",
    "# - Group by email, standardized first and last name and concatenate trainer_id\n",
    "# - Group by last name (some trainers have several e-mail addresses)\n",
    "# - Group by email_norm (some trainers have reversed first and last names)\n",
    "# - Delete duplicates\n",
    "df_trainer_cleaned['email_norm'] = df_trainer_cleaned['email'].apply(normalize_email)\n",
    "df_trainer_cleaned['last_name_norm'] = df_trainer_cleaned['last_name'].apply(normalize_name)\n",
    "df_trainer_cleaned['first_name_norm'] = df_trainer_cleaned['first_name'].apply(normalize_name)\n",
    "\n",
    "df_trainer_cleaned = df_trainer_cleaned[~df_trainer_cleaned['email_norm'].str.contains(\"mysmartmove\", case=False, na=False)]\n",
    "df_trainer_cleaned = df_trainer_cleaned[~df_trainer_cleaned['email_norm'].str.contains(\"gelin\", case=False, na=False)]\n",
    "df_trainer_cleaned = df_trainer_cleaned[~df_trainer_cleaned['email_norm'].str.contains(\"laffet\", case=False, na=False)]\n",
    "\n",
    "\n",
    "df_trainer_grouped = df_trainer_cleaned.groupby(['email_norm', 'last_name_norm', 'first_name_norm'], as_index=False).agg({\n",
    "    'trainer_id': lambda x: ', '.join(map(str, sorted(x))),\n",
    "    'trainer_created_at' : 'min'\n",
    "})\n",
    "\n",
    "df_trainer_grouped = df_trainer_grouped.groupby(\n",
    "    ['last_name_norm'], as_index=False).agg({\n",
    "    'email_norm': lambda x: ', '.join(sorted(set(x))), \n",
    "    'trainer_id': lambda x: ', '.join(sorted(set(x))),\n",
    "    'trainer_created_at': 'min'  \n",
    "})\n",
    "\n",
    "df_trainer_grouped = df_trainer_grouped.groupby('email_norm', as_index=False).agg({\n",
    "    'last_name_norm': lambda x: ', '.join(sorted(set(x))),\n",
    "    'trainer_id': lambda x: ', '.join(sorted(set(x))),\n",
    "    'trainer_created_at': 'min'\n",
    "})\n",
    "\n",
    "df_trainer_grouped=df_trainer_grouped.drop_duplicates()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 431,
   "id": "2e0de632-c1db-4216-b176-90d50dd2c5bf",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Creation of the unified dataset (pre-cleaning): dataset_without_cleaning\n",
    "# RUNNERS\n",
    "# - Drop irrelevant columns: password, public_id, email\n",
    "# - Rename 'id' to 'runner_id'\n",
    "# - Rename 'created_at' to 'runner_created_at'\n",
    "# SESSIONS\n",
    "# - Drop irrelevant colpmns: public_id, file_path, comment\n",
    "# - Rename 'id' to 'session_id'\n",
    "# - Rename 'created_at' to 'session_created_at'\n",
    "# STRIDE_PARAMETERS\n",
    "# - Drop irrelevant columns: public_id, id\n",
    "# - Move 'session_id' column to the first position\n",
    "# ANG_PARAMETERS\n",
    "# - Drop irrelevant columns: id, public_id\n",
    "# - Move 'session_id' column to the first position\n",
    "# - Combine all phase measurements into a single row per session\n",
    "# Final step: create 'dataset_without_cleaning' by merging all tables using an inner join on 'session_id'\n",
    "\n",
    "df_runner_preprocessed=df_runner.copy()\n",
    "df_runner_preprocessed=df_runner_preprocessed.drop(columns=[\"email\", \"password\", \"public_id\"])\n",
    "df_runner_preprocessed=df_runner_preprocessed.rename(columns={\"id\":\"runner_id\"})\n",
    "df_runner_preprocessed=df_runner_preprocessed.rename(columns={\"created_at\":\"runner_created_at\"})\n",
    "\n",
    "df_session_preprocessed=df_session.copy()\n",
    "df_session_preprocessed=df_session_preprocessed.drop(columns=[\"public_id\", \"file_path\", \"comment\"])\n",
    "df_session_preprocessed=df_session_preprocessed.rename(columns={\"id\":\"session_id\"})\n",
    "df_session_preprocessed=df_session_preprocessed.rename(columns={\"created_at\":\"session_created_at\"})\n",
    "\n",
    "df_stride_parameters_preprocessed=df_stride_parameters.copy()\n",
    "df_stride_parameters_preprocessed=df_stride_parameters_preprocessed.drop(columns=[\"public_id\", \"id\"])\n",
    "col=df_stride_parameters_preprocessed.pop(\"session_id\")\n",
    "df_stride_parameters_preprocessed.insert(0,\"session_id\", col)\n",
    "df_stride_parameters_preprocessed=df_stride_parameters_preprocessed.rename(columns={\"created_at\":\"stride_parameters_created_at\"})\n",
    "\n",
    "df_ang_parameters_preprocessed=df_ang_parameters.copy()\n",
    "df_ang_parameters_preprocessed=df_ang_parameters_preprocessed.drop(columns=[\"public_id\", \"id\"])\n",
    "col=df_ang_parameters_preprocessed.pop(\"session_id\")\n",
    "df_ang_parameters_preprocessed.insert(0,\"session_id\", col)\n",
    "df_ang_parameters_preprocessed=df_ang_parameters_preprocessed.rename(columns={\"created_at\":\"ang_parameters_created_at\"})\n",
    "df_ang_parameters_preprocessed=df_ang_parameters_preprocessed.pivot(index=\"session_id\", columns=\"phase\", values=[\"ang_parameters_created_at\", \"pelvis_inc_min\",\t\n",
    "\"pelvis_inc_max\", \"pelvis_ver_min\", \"pelvis_ver_max\", \"rhip_add_min\", \"rhip_add_max\", \"rhip_flex_min\", \"rhip_flex_max\", \"rhip_rot_min\",\n",
    "\"rhip_rot_max\", \"lhip_add_min\", \"lhip_add_max\", \"lhip_flex_min\", \"lhip_flex_max\" ,\"lhip_rot_min\", \"lhip_rot_max\",\n",
    "\"rknee_val_min\", \"rknee_val_max\", \"rknee_flex_min\", \"rknee_flex_max\", \"rknee_rot_min\", \"rknee_rot_max\", \"lknee_val_min\",\n",
    "\"lknee_val_max\", \"lknee_flex_min\", \"lknee_flex_max\", \"lknee_rot_min\", \"lknee_rot_max\" ])\n",
    "df_ang_parameters_preprocessed.columns = [f\"{col[0]}_{col[1]}\" for col in df_ang_parameters_preprocessed.columns]\n",
    "df_ang_parameters_preprocessed.reset_index(inplace=True)\n",
    "cols_to_convert = df_ang_parameters_preprocessed.columns.drop([\"session_id\", \"ang_parameters_created_at_global\", \"ang_parameters_created_at_flight\", \"ang_parameters_created_at_support\"])\n",
    "df_ang_parameters_preprocessed[cols_to_convert] = df_ang_parameters_preprocessed[cols_to_convert].apply(pd.to_numeric, errors=\"coerce\")\n",
    "\n",
    "dataset_without_cleaning=pd.merge(df_runner_preprocessed, df_session_preprocessed, on=\"runner_id\", how=\"inner\")\n",
    "dataset_without_cleaning=pd.merge(dataset_without_cleaning, df_stride_parameters_preprocessed, on=\"session_id\", how=\"inner\")\n",
    "dataset_without_cleaning=pd.merge(dataset_without_cleaning, df_ang_parameters_preprocessed, on=\"session_id\", how=\"inner\")\n",
    "col=dataset_without_cleaning.pop(\"session_id\")\n",
    "dataset_without_cleaning.insert(2,\"session_id\", col)\n",
    "col=dataset_without_cleaning.pop(\"session_created_at\")\n",
    "dataset_without_cleaning.insert(3,\"session_created_at\", col)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 432,
   "id": "93e3773f-414a-40f0-9d85-25033e311d03",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Data cleaning - STEP 1: FILTERING\n",
    "# - Remove duplicate rows\n",
    "# - Drop irrelevant columns: \n",
    "#    runner_createt,at, d,te, start_time, stop_time, calibration_time,\n",
    "#    ang_parameters_created_at_flight, ang_parameters_created_at_support, \n",
    "#    ang_parameters_created_at_global, stride_parameters_created_at\n",
    "# - Remove rows where session_created_at is on or after 2024-06-01\n",
    "# - Remove rows where trainer equals 1, 2, or is between 34 and 44 (inclusive)\n",
    "# - Remove rows where first_name or last_name is 'test' or 'moi'\n",
    "# - Drop name-related columns: first_name, last_name, first_name_norm, last_name_norm\n",
    "# - Remove rows where diagnosis is 'Test', 'Test2', or 'Marche'\n",
    "# - Remove rows where pace > 250\n",
    "# - Remove rows where stride_length < 0\n",
    "# - Keep only rows where isref = 1 \n",
    "# Each row represents the first session for one patient, one pathology, and one activity.\n",
    "\n",
    "dataset_cleaned=dataset_without_cleaning.copy()\n",
    "dataset_cleaned=dataset_cleaned.drop_duplicates()\n",
    "\n",
    "dataset_cleaned=dataset_cleaned.drop(columns=[\"runner_created_at\", \"date\", \n",
    "                                              \"start_time\", \"stop_time\", \"calibration_time\", \"ang_parameters_created_at_flight\", \n",
    "                                              \"ang_parameters_created_at_support\", \"ang_parameters_created_at_global\", \n",
    "                                              \"stride_parameters_created_at\"])\n",
    "\n",
    "dataset_cleaned[\"session_created_at\"]=pd.to_datetime(dataset_cleaned[\"session_created_at\"])\n",
    "dataset_cleaned=dataset_cleaned[dataset_cleaned[\"session_created_at\"]> \"2023-12-31\"]\n",
    "\n",
    "dataset_cleaned = dataset_cleaned[(dataset_cleaned[\"trainer_id\"] >= 3) & \n",
    "                                  (~dataset_cleaned[\"trainer_id\"].between(34, 44))]\n",
    "\n",
    "\n",
    "dataset_cleaned[\"last_name_norm\"]=dataset_cleaned[\"last_name\"].apply(normalize_name)\n",
    "dataset_cleaned[\"first_name_norm\"]=dataset_cleaned[\"first_name\"].apply(normalize_name)\n",
    "\n",
    "dataset_cleaned=dataset_cleaned[~dataset_cleaned['last_name_norm'].isin([\"test\", \"moi\"]) & \n",
    "                                ~dataset_cleaned['first_name_norm'].isin([\"test\", \"moi\"])]\n",
    "\n",
    "dataset_cleaned=dataset_cleaned.drop(columns=[\"first_name\", \"last_name\", \"first_name_norm\", \"last_name_norm\"])\n",
    "\n",
    "dataset_cleaned=dataset_cleaned[~dataset_cleaned['diagnosis'].isin([\"Test\", \"Test2\", \"Marche \", \"Analyse marche\", \"Douleur latéral externe pied gauche \" ])]\n",
    "dataset_cleaned=dataset_cleaned[dataset_cleaned[\"body_region\"] != \"Test\"]\n",
    "\n",
    "dataset_cleaned=dataset_cleaned[dataset_cleaned[\"pace\"] < 250]\n",
    "\n",
    "dataset_cleaned=dataset_cleaned[dataset_cleaned[\"stride_length\"]>0]\n",
    "\n",
    "dataset_cleaned=dataset_cleaned[dataset_cleaned[\"isref\"]==1]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 433,
   "id": "f63139dd-2038-4eae-b5b0-6fb503b7e590",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Data cleaning - STEP 2: HANDLE STRANGE VALUES\n",
    "# - Standardize body_region values: change \"Dos/Bassin\" to \"Dos/bassin\"\n",
    "# - Harmonize values between diagnosis and body_region\n",
    "# - Create a new column: 'Diagnosis_body_region'\n",
    "# Outlier Detection & Correction:\n",
    "# - Height (size): replace outliers (<100 cm or >230 cm) with the average by sex and age group (adult/child)\n",
    "# - Weight: replace outliers (<15 kg or >150 kg) using the same approach (sex and age group)\n",
    "# - Age: replace outliers (<5 or >100 years) with the sample mean\n",
    "# - Add column with age category (child or adult)\n",
    "# Add derived columns:\n",
    "# - duration_corrected = (nb_steps / 2) * stride_duration\n",
    "# - distance_corrected = (nb_steps / 2) * stride_length\n",
    "# - pace_corrected = (60 * 2) / stride_duration\n",
    "# - speed_corrected = stride_length* pace_corrected /2/60*3.6\n",
    "# Data consistency fixes:\n",
    "# - If right_step_duration and left_step_duration are both 0, set right_step_duration = stride_duration / 2\n",
    "# - Normalize right_vlr and left_vlr: divide by 100, then multiply by 60 (original code contained an error)\n",
    "# - Replace 0 values with opposite-side values (if available) for:\n",
    "#  - right_acc_peak, left_acc_peak\n",
    "#  - right_vlr, left_vlr\n",
    "#  - right_step_length, left_step_length\n",
    "# Recalculate stride_length as the sum of right_step_length and left_step_length\n",
    "\n",
    "mask_body_region = (dataset_cleaned[\"body_region\"] == \"Dos/Bassin\")\n",
    "dataset_cleaned.loc[mask_body_region, 'body_region'] = \"Dos/bassin\"\n",
    "\n",
    "dataset_cleaned.loc[\n",
    "    (dataset_cleaned['diagnosis'] == 'Gonarthrose') & \n",
    "    (dataset_cleaned['body_region'] == 'Hanche/cuisse gauche'), \n",
    "    'body_region' ] = 'Genou/jambe gauche'\n",
    "\n",
    "dataset_cleaned.loc[\n",
    "    (dataset_cleaned['diagnosis'] == 'Rupture des ligaments croisés') & \n",
    "    (dataset_cleaned['body_region'] == 'Pied/cheville droit(e)'), \n",
    "    'body_region' ] = 'Genou/jambe droit(e)'\n",
    "\n",
    "dataset_cleaned.loc[\n",
    "    (dataset_cleaned['diagnosis'] == 'Fracture de la cheville') & \n",
    "    (dataset_cleaned['body_region'] == 'Genou/jambe gauche'), \n",
    "    'body_region' ] = 'Pied/cheville gauche'\n",
    "\n",
    "dataset_cleaned.loc[\n",
    "    (dataset_cleaned['diagnosis'] == 'Entorse du genou') & \n",
    "    (dataset_cleaned['body_region'] == 'Hanche/cuisse gauche'), \n",
    "    'body_region' ] = 'Genou/jambe gauche'\n",
    "\n",
    "dataset_cleaned.loc[\n",
    "    (dataset_cleaned['diagnosis'] == 'Tendinopathie quadricipitale') & \n",
    "    (dataset_cleaned['body_region'] == 'Pied/cheville gauche'), \n",
    "    'body_region' ] = 'Genou/jambe gauche'\n",
    "\n",
    "dataset_cleaned.loc[\n",
    "    (dataset_cleaned['diagnosis'] == 'Prothèse de hanche') & \n",
    "    (dataset_cleaned['body_region'].isin(['Genou/jambe gauche', 'Pied/cheville gauche'])), \n",
    "    'body_region' ] = 'Hanche/cuisse gauche'\n",
    "\n",
    "dataset_cleaned.loc[\n",
    "    (dataset_cleaned['diagnosis'] == 'Lombalgie') & \n",
    "    (dataset_cleaned['body_region'].isin(['Hanche/cuisse droite'])), \n",
    "    'body_region' ] = 'Dos/bassin'\n",
    "\n",
    "dataset_cleaned.loc[\n",
    "    (dataset_cleaned['diagnosis'] == 'Syndrome rotulien (SFP)') & \n",
    "    (dataset_cleaned['body_region'].isin(['Pied/cheville droit(e)'])), \n",
    "    'body_region' ] = 'Genou/jambe droit(e)'\n",
    "\n",
    "dataset_cleaned.loc[\n",
    "    (dataset_cleaned['diagnosis'] == 'Fracture du genou') & \n",
    "    (dataset_cleaned['body_region'].isin(['Pied/cheville droit(e)'])), \n",
    "    'body_region' ] = 'Genou/jambe droit(e)'\n",
    "\n",
    "dataset_cleaned = dataset_cleaned[\n",
    "    ~((dataset_cleaned['diagnosis'] == 'Gonarthrose') & (dataset_cleaned['body_region'] == 'Dos/bassin'))\n",
    "]\n",
    "\n",
    "dataset_cleaned[\"diagnosis_body_region\"] = dataset_cleaned[\"diagnosis\"] + \"_\" + dataset_cleaned[\"body_region\"]\n",
    "col=dataset_cleaned.pop(\"diagnosis_body_region\")\n",
    "dataset_cleaned.insert(10,\"diagnosis_body_region\", col)\n",
    "\n",
    "rename = { \n",
    "    'Chirurgie cheville ligamentaire_Pied/cheville droit(e)': 'Chirurgie cheville ligamentaire droite',\n",
    "    'Chirurgie cheville ligamentaire_Pied/cheville gauche' : 'Chirurgie cheville ligamentaire gauche',\n",
    "    'Entorse cheville_Pied/cheville droit(e)': 'Entorse cheville droite',\n",
    "    'Entorse cheville_Pied/cheville gauche': 'Entorse cheville gauche',\n",
    "    'Déséquilibre _Hanche/cuisse droite' : 'Déséquilibre hanche droite',\n",
    "    'Déséquilibre _Hanche/cuisse gauche' : 'Déséquilibre hanche gauche',\n",
    "    'Entorse LLI_Genou/jambe droit(e)' : 'Entore LLI genou droit',\n",
    "    'Entorse LLI_Genou/jambe gauche' : 'Entore LLI genou gauche',\n",
    "    'Fracture de la cheville_Pied/cheville droit(e)': 'Fracture de la cheville droite',\n",
    "    'Fracture de la cheville_Pied/cheville gauche': 'Fracture de la cheville gauche',\n",
    "    'Fracture métatarse _Pied/cheville droit(e)': 'Fracture métatarse pied droit',\n",
    "    'Fracture métatarse _Pied/cheville droit(e)': 'Fracture métatarse pied gauche',\n",
    "    'Gonarthrose_Genou/jambe droit(e)' : 'Gonarthrose genou droit',\n",
    "    'Gonarthrose_Genou/jambe gauche' : 'Gonarthrose genou gauche',\n",
    "    'Lombalgie_Dos/bassin': 'Lombalgie',\n",
    "    'Prothèse de hanche_Hanche/cuisse droite': 'Prothèse de hanche droite',\n",
    "    'Prothèse de hanche_Hanche/cuisse gauche': 'Prothèse de hanche gauche',\n",
    "    'PTG_Genou/jambe droit(e)' : 'PTG jambe droite',\n",
    "    'PTG_Genou/jambe gauche' : 'PTG jambe gauche',\n",
    "    'Rupture des ligaments croisés_Genou/jambe droit(e)' : 'Rupture des ligaments croisés droite',\n",
    "    'Rupture des ligaments croisés_Genou/jambe gauche' : 'Rupture des ligaments croisés gauche',  \n",
    "    \"Rupture tendon d'Achille _Pied/cheville droit(e)\": \"Rupture tendon d'Achille droit\",\n",
    "    \"Rupture tendon d'Achille _Pied/cheville gauche\": \"Rupture tendon d'Achille gauche\",\n",
    "    'Rupture tendon quadricipital _Genou/jambe gauche' : 'Rupture tendon quadricipital gauche',\n",
    "    'Rupture tendon quadricipital _Genou/jambe droit(e)' : 'Rupture tendon quadricipital droit',\n",
    "    'Syndrome rotulien (SFP)_Genou/jambe droit(e)': 'Syndrome rotulien droit',\n",
    "    'Syndrome rotulien (SFP)_Genou/jambe gauche': 'Syndrome rotulien gauche',\n",
    "    \"Tendinopathie d'Achille_Pied/cheville droit(e)\" : \"Tendinopathie d'Achille droite\",\n",
    "    \"Tendinopathie d'Achille_Pied/cheville gauche\" : \"Tendinopathie d'Achille gauche\",\n",
    "    'Tendinopathie quadricipitale_Genou/jambe gauche': \"Tendinopathie quadricipitale gauche\",\n",
    "    'Tendinopathie quadricipitale_Genou/jambe droit(e)': \"Tendinopathie quadricipitale droit\",\n",
    "    'Periostite  tibiale_Genou/jambe droit(e)' : 'Périostitie tibiale droite',\n",
    "    'Periostite  tibiale_Genou/jambe gauche' : 'Périostitie tibiale gauche',\n",
    "    \"Tenosynovite insertion distale longe fibulaire _Pied/cheville droit(e)\": \"Tendinopathie fibulaire droite\",\n",
    "    \"Tenosynovite insertion distale longe fibulaire _Pied/cheville gauche\": \"Tendinopathie fibulaire gauche\",\n",
    "     }\n",
    "\n",
    "dataset_cleaned['diagnosis_body_region'] = dataset_cleaned['diagnosis_body_region'].replace(rename)\n",
    "\n",
    "mask_size = (dataset_cleaned['size'] < 100) | (dataset_cleaned['size'] > 230)\n",
    "mean_size = dataset_cleaned.loc[\n",
    "    (dataset_cleaned['size'] >= 100) & (dataset_cleaned['size'] <= 230)\n",
    "].groupby(['sex', dataset_cleaned['age'] >= 18])['size'].mean()\n",
    "dataset_cleaned.loc[mask_size & (dataset_cleaned['sex'] == 'M') & (dataset_cleaned['age'] >= 18), 'size'] = round(mean_size['M', True],0)\n",
    "dataset_cleaned.loc[mask_size & (dataset_cleaned['sex'] == 'M') & (dataset_cleaned['age'] < 18), 'size'] = round(mean_size['M', False],0)\n",
    "dataset_cleaned.loc[mask_size & (dataset_cleaned['sex'] == 'F') & (dataset_cleaned['age'] >= 18), 'size'] = round(mean_size['F', True],0)\n",
    "dataset_cleaned.loc[mask_size & (dataset_cleaned['sex'] == 'F') & (dataset_cleaned['age'] < 18), 'size'] = round(mean_size['F', False],0)\n",
    "\n",
    "mask_weight = (dataset_cleaned['weight'] < 15) | (dataset_cleaned['weight'] > 150)\n",
    "mean_weights = dataset_cleaned.loc[\n",
    "    (dataset_cleaned['weight'] >= 15) & (dataset_cleaned['weight'] <= 150)\n",
    "].groupby(['sex', dataset_cleaned['age'] >= 18])['weight'].mean()\n",
    "dataset_cleaned.loc[mask_weight & (dataset_cleaned['sex'] == 'M') & (dataset_cleaned['age'] >= 18), 'weight'] = round(mean_weights['M', True],0)\n",
    "dataset_cleaned.loc[mask_weight & (dataset_cleaned['sex'] == 'M') & (dataset_cleaned['age'] < 18), 'weight'] = round(mean_weights['M', False],0)\n",
    "dataset_cleaned.loc[mask_weight & (dataset_cleaned['sex'] == 'F') & (dataset_cleaned['age'] >= 18), 'weight'] = round(mean_weights['F', True],0)\n",
    "dataset_cleaned.loc[mask_weight & (dataset_cleaned['sex'] == 'F') & (dataset_cleaned['age'] < 18), 'weight'] = round(mean_weights['F', False],0)\n",
    "\n",
    "mask_age = (dataset_cleaned['age'] < 5) | (dataset_cleaned['age'] > 100)\n",
    "mean_age = dataset_cleaned.loc[~mask_age, 'age'].mean()\n",
    "dataset_cleaned.loc[mask_age, 'age'] = round(mean_age,0)\n",
    "\n",
    "dataset_cleaned['duration_corrected'] = (dataset_cleaned[\"nb_steps\"])*(dataset_cleaned[\"stride_duration\"])/2\n",
    "idx = dataset_cleaned.columns.get_loc(\"duration\")\n",
    "col=dataset_cleaned.pop(\"duration_corrected\")\n",
    "dataset_cleaned.insert(idx+1,\"duration_corrected\", col)\n",
    "\n",
    "dataset_cleaned['distance_corrected'] = (dataset_cleaned[\"nb_steps\"])*(dataset_cleaned[\"stride_length\"])/2\n",
    "idx = dataset_cleaned.columns.get_loc(\"distance\")\n",
    "col=dataset_cleaned.pop(\"distance_corrected\")\n",
    "dataset_cleaned.insert(idx+1,\"distance_corrected\", col)\n",
    "\n",
    "dataset_cleaned['pace_corrected'] = 120/(dataset_cleaned[\"stride_duration\"])\n",
    "idx = dataset_cleaned.columns.get_loc(\"pace\")\n",
    "col=dataset_cleaned.pop(\"pace_corrected\")\n",
    "dataset_cleaned.insert(idx+1,\"pace_corrected\", col)\n",
    "\n",
    "dataset_cleaned['speed_corrected'] = (dataset_cleaned[\"stride_length\"])*(dataset_cleaned[\"pace_corrected\"])/2/60*3.6\n",
    "idx = dataset_cleaned.columns.get_loc(\"speed\")\n",
    "col=dataset_cleaned.pop(\"speed_corrected\")\n",
    "dataset_cleaned.insert(idx+1, \"speed_corrected\", col)\n",
    "\n",
    "mask_step_duration = (dataset_cleaned['right_step_duration'] == 0) & (dataset_cleaned['left_step_duration'] == 0)\n",
    "dataset_cleaned.loc[mask_step_duration, 'right_step_duration'] = dataset_cleaned.loc[mask_step_duration, 'stride_duration'] / 2\n",
    "dataset_cleaned.loc[mask_step_duration, 'left_step_duration'] = dataset_cleaned.loc[mask_step_duration, 'stride_duration'] / 2\n",
    "    \n",
    "dataset_cleaned[\"right_vlr\"]= dataset_cleaned[\"right_vlr\"]/100*60\n",
    "dataset_cleaned[\"left_vlr\"]= dataset_cleaned[\"left_vlr\"]/100*60\n",
    "\n",
    "dataset_cleaned.loc[dataset_cleaned['right_acc_peak'] == 0, 'right_acc_peak'] = dataset_cleaned['left_acc_peak']\n",
    "dataset_cleaned.loc[dataset_cleaned['left_acc_peak'] == 0, 'left_acc_peak'] = dataset_cleaned['right_acc_peak']\n",
    "\n",
    "dataset_cleaned.loc[dataset_cleaned['right_vlr'] == 0, 'right_vlr'] = dataset_cleaned['left_vlr']\n",
    "dataset_cleaned.loc[dataset_cleaned['left_vlr'] == 0, 'left_vlr'] = dataset_cleaned['right_vlr']\n",
    "\n",
    "dataset_cleaned.loc[dataset_cleaned['right_step_length'] == 0, 'right_step_length'] = dataset_cleaned['left_step_length']\n",
    "dataset_cleaned.loc[dataset_cleaned['left_step_length'] == 0, 'left_step_length'] = dataset_cleaned['right_step_length']\n",
    "\n",
    "dataset_cleaned[\"stride_length\"] = dataset_cleaned[\"right_step_length\"] + dataset_cleaned[\"left_step_length\"]\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 434,
   "id": "202c76ee-853f-4f1b-b680-69655bed4f0d",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Data Cleaning - STEP 3: ADD SYMMETRY\n",
    "# - Step symmetry: calculated as the mean of step length symmetry and step duration symmetry\n",
    "#   - Stride duration symmetry formula:\n",
    "#   ROUND(100*(1 - ABS(right_step_duration - left_step_duration) / (0.5 * (right_step_duration + left_step_duration))))\n",
    "#   Note: In JavaScript, there was an error — right_step_duration was mistakenly used twice.\n",
    "#   - Stride length symmetry formula : \n",
    "#   ROUND(100(*1 - ABS(right_step_length - left_step_length) / (0.5 * (right_step_length + left_step_length))))\n",
    "# - Pelvis symmetry : (global)\n",
    "#   - Formula : ROUND(100*(1-ABS(pelvis_inc_min_global+pelvis_inc_max_global)/20))\n",
    "# - VLR symmetry :\n",
    "#   -Formula : ROUND(100 * (1 - ABS(right - left) / divisor)), divisor = 3 walk, 8 run\n",
    "# - Peak symmetry : \n",
    "#   -Formula : ROUND(100 * (1 - ABS(right - left) / divisor)), divisor = 30 walk, 150 run\n",
    "# Formula hip and knee symmetry : average amplitudes and oriented averages (see javascript)\n",
    "\n",
    "\n",
    "dataset_cleaned[\"symmetry_step_duration\"] = dataset_cleaned.apply(\n",
    "    lambda row: ComputeSymmetryStep(row[\"right_step_duration\"], row[\"left_step_duration\"]),\n",
    "    axis=1\n",
    ")\n",
    "\n",
    "dataset_cleaned[\"symmetry_step_duration\"] = dataset_cleaned[\"symmetry_step_duration\"].clip(lower=0)\n",
    "\n",
    "\n",
    "dataset_cleaned[\"symmetry_step_length\"] = dataset_cleaned.apply(\n",
    "    lambda row: ComputeSymmetryStep(row[\"right_step_length\"], row[\"left_step_length\"]),\n",
    "    axis=1\n",
    ")\n",
    "\n",
    "dataset_cleaned[\"symmetry_step_length\"] = dataset_cleaned[\"symmetry_step_length\"].clip(lower=0)\n",
    "\n",
    "dataset_cleaned[\"symmetry_step\"] = round((dataset_cleaned[\"symmetry_step_duration\"]+ dataset_cleaned[\"symmetry_step_length\"])/2, 0)\n",
    "idx = dataset_cleaned.columns.get_loc(\"left_step_length\")\n",
    "col=dataset_cleaned.pop(\"symmetry_step_duration\")\n",
    "dataset_cleaned.insert(idx+1,\"symmetry_step_duration\", col)\n",
    "col=dataset_cleaned.pop(\"symmetry_step_length\")\n",
    "dataset_cleaned.insert(idx+2,\"symmetry_step_length\", col)\n",
    "col=dataset_cleaned.pop(\"symmetry_step\")\n",
    "dataset_cleaned.insert(idx+3,\"symmetry_step\", col)\n",
    "\n",
    "dataset_cleaned[\"symmetry_pelvis\"] = dataset_cleaned.apply(\n",
    "    lambda row: ComputeSymmetryPelvis(row[\"pelvis_inc_min_global\"], row[\"pelvis_inc_max_global\"]),\n",
    "    axis=1\n",
    ")\n",
    "dataset_cleaned[\"symmetry_pelvis\"] = dataset_cleaned[\"symmetry_pelvis\"].clip(lower=0)\n",
    "\n",
    "dataset_cleaned[\"symmetry_pelvis_support\"] = dataset_cleaned.apply(\n",
    "    lambda row: ComputeSymmetryPelvis(row[\"pelvis_inc_min_support\"], row[\"pelvis_inc_max_support\"]),\n",
    "    axis=1\n",
    ")\n",
    "dataset_cleaned[\"symmetry_pelvis_support\"] = dataset_cleaned[\"symmetry_pelvis_support\"].clip(lower=0)\n",
    "\n",
    "dataset_cleaned[\"symmetry_pelvis_flight\"] = dataset_cleaned.apply(\n",
    "    lambda row: ComputeSymmetryPelvis(row[\"pelvis_inc_min_flight\"], row[\"pelvis_inc_max_flight\"]),\n",
    "    axis=1\n",
    ")\n",
    "dataset_cleaned[\"symmetry_pelvis_flight\"] = dataset_cleaned[\"symmetry_pelvis_flight\"].clip(lower=0)\n",
    "\n",
    "\n",
    "idx = dataset_cleaned.columns.get_loc(\"pelvis_inc_max_support\")\n",
    "col=dataset_cleaned.pop(\"symmetry_pelvis\")\n",
    "dataset_cleaned.insert(idx+1,\"symmetry_pelvis\", col)\n",
    "col=dataset_cleaned.pop(\"symmetry_pelvis_support\")\n",
    "dataset_cleaned.insert(idx+2,\"symmetry_pelvis_support\", col)\n",
    "col=dataset_cleaned.pop(\"symmetry_pelvis_flight\")\n",
    "dataset_cleaned.insert(idx+3,\"symmetry_pelvis_flight\", col)\n",
    "\n",
    "dataset_cleaned[\"symmetry_acc_peak\"] = dataset_cleaned.apply(\n",
    "    lambda row: ComputeSymmetryPeak(row[\"right_acc_peak\"], row[\"left_acc_peak\"], row[\"activity\"], row[\"weight\"]),\n",
    "    axis=1\n",
    ")\n",
    "dataset_cleaned[\"symmetry_acc_peak\"] = dataset_cleaned[\"symmetry_acc_peak\"].clip(lower=0)\n",
    "idx = dataset_cleaned.columns.get_loc(\"left_acc_peak\")\n",
    "col=dataset_cleaned.pop(\"symmetry_acc_peak\")\n",
    "dataset_cleaned.insert(idx+1,\"symmetry_acc_peak\", col)\n",
    "\n",
    "\n",
    "dataset_cleaned[\"symmetry_vlr\"] = dataset_cleaned.apply(\n",
    "    lambda row: ComputeSymmetryVlr(row[\"right_vlr\"], row[\"left_vlr\"], row[\"activity\"]),\n",
    "    axis=1\n",
    ")\n",
    "dataset_cleaned[\"symmetry_vlr\"] = dataset_cleaned[\"symmetry_vlr\"].clip(lower=0)\n",
    "idx = dataset_cleaned.columns.get_loc(\"left_vlr\")\n",
    "col=dataset_cleaned.pop(\"symmetry_vlr\")\n",
    "dataset_cleaned.insert(idx+1,\"symmetry_vlr\", col)\n",
    "\n",
    "\n",
    "hip_add= 70\n",
    "hip_flex=120\n",
    "hip_rot=65\n",
    "\n",
    "\n",
    "dataset_cleaned[\"amplitude_rhip_add\"] = dataset_cleaned[\"rhip_add_max_global\"]-dataset_cleaned[\"rhip_add_min_global\"]\n",
    "dataset_cleaned[\"mean_rhip_add\"]=(-0.5)*(dataset_cleaned[\"rhip_add_max_global\"]+dataset_cleaned[\"rhip_add_min_global\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lhip_add\"] = dataset_cleaned[\"lhip_add_max_global\"]-dataset_cleaned[\"lhip_add_min_global\"]\n",
    "dataset_cleaned[\"mean_lhip_add\"]=(0.5)*(dataset_cleaned[\"lhip_add_max_global\"]+dataset_cleaned[\"lhip_add_min_global\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_rhip_flex\"] = dataset_cleaned[\"rhip_flex_max_global\"]-dataset_cleaned[\"rhip_flex_min_global\"]\n",
    "dataset_cleaned[\"mean_rhip_flex\"]=(0.5)*(dataset_cleaned[\"rhip_flex_max_global\"]+dataset_cleaned[\"rhip_flex_min_global\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lhip_flex\"] = dataset_cleaned[\"lhip_flex_max_global\"]-dataset_cleaned[\"lhip_flex_min_global\"]\n",
    "dataset_cleaned[\"mean_lhip_flex\"]=(0.5)*(dataset_cleaned[\"lhip_flex_max_global\"]+dataset_cleaned[\"lhip_flex_min_global\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_rhip_rot\"] = dataset_cleaned[\"rhip_rot_max_global\"]-dataset_cleaned[\"rhip_rot_min_global\"]\n",
    "dataset_cleaned[\"mean_rhip_rot\"]=(0.5)*(dataset_cleaned[\"rhip_rot_max_global\"]+dataset_cleaned[\"rhip_rot_min_global\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lhip_rot\"] = dataset_cleaned[\"lhip_rot_max_global\"]-dataset_cleaned[\"lhip_rot_min_global\"]\n",
    "dataset_cleaned[\"mean_lhip_rot\"]=(-0.5)*(dataset_cleaned[\"lhip_rot_max_global\"]+dataset_cleaned[\"lhip_rot_min_global\"])\n",
    "\n",
    "dataset_cleaned[\"symmetry_hip\"]= round((1/6)*(ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rhip_add\"], dataset_cleaned[\"amplitude_lhip_add\"], hip_add/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rhip_add\"], dataset_cleaned[\"mean_lhip_add\"], hip_add/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rhip_flex\"], dataset_cleaned[\"amplitude_lhip_flex\"], hip_flex/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rhip_flex\"], dataset_cleaned[\"mean_lhip_flex\"], hip_flex/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rhip_rot\"], dataset_cleaned[\"amplitude_lhip_rot\"], hip_rot/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rhip_rot\"], dataset_cleaned[\"mean_lhip_rot\"], hip_rot/2)),0)\n",
    "\n",
    "dataset_cleaned[\"symmetry_hip\"] = dataset_cleaned[\"symmetry_hip\"].clip(lower=0)\n",
    "\n",
    "dataset_cleaned[\"amplitude_rhip_add_flight\"] = dataset_cleaned[\"rhip_add_max_flight\"]-dataset_cleaned[\"rhip_add_min_flight\"]\n",
    "dataset_cleaned[\"mean_rhip_add_flight\"]=(-0.5)*(dataset_cleaned[\"rhip_add_max_flight\"]+dataset_cleaned[\"rhip_add_min_flight\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lhip_add_flight\"] = dataset_cleaned[\"lhip_add_max_flight\"]-dataset_cleaned[\"lhip_add_min_flight\"]\n",
    "dataset_cleaned[\"mean_lhip_add_flight\"]=(0.5)*(dataset_cleaned[\"lhip_add_max_flight\"]+dataset_cleaned[\"lhip_add_min_flight\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_rhip_flex_flight\"] = dataset_cleaned[\"rhip_flex_max_flight\"]-dataset_cleaned[\"rhip_flex_min_flight\"]\n",
    "dataset_cleaned[\"mean_rhip_flex_flight\"]=(0.5)*(dataset_cleaned[\"rhip_flex_max_flight\"]+dataset_cleaned[\"rhip_flex_min_flight\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lhip_flex_flight\"] = dataset_cleaned[\"lhip_flex_max_flight\"]-dataset_cleaned[\"lhip_flex_min_flight\"]\n",
    "dataset_cleaned[\"mean_lhip_flex_flight\"]=(0.5)*(dataset_cleaned[\"lhip_flex_max_flight\"]+dataset_cleaned[\"lhip_flex_min_flight\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_rhip_rot_flight\"] = dataset_cleaned[\"rhip_rot_max_flight\"]-dataset_cleaned[\"rhip_rot_min_flight\"]\n",
    "dataset_cleaned[\"mean_rhip_rot_flight\"]=(0.5)*(dataset_cleaned[\"rhip_rot_max_flight\"]+dataset_cleaned[\"rhip_rot_min_flight\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lhip_rot_flight\"] = dataset_cleaned[\"lhip_rot_max_flight\"]-dataset_cleaned[\"lhip_rot_min_flight\"]\n",
    "dataset_cleaned[\"mean_lhip_rot_flight\"]=(-0.5)*(dataset_cleaned[\"lhip_rot_max_flight\"]+dataset_cleaned[\"lhip_rot_min_flight\"])\n",
    "\n",
    "dataset_cleaned[\"symmetry_hip_flight\"]= round((1/6)*(ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rhip_add_flight\"], dataset_cleaned[\"amplitude_lhip_add_flight\"], hip_add/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rhip_add_flight\"], dataset_cleaned[\"mean_lhip_add_flight\"], hip_add/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rhip_flex_flight\"], dataset_cleaned[\"amplitude_lhip_flex_flight\"], hip_flex/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rhip_flex_flight\"], dataset_cleaned[\"mean_lhip_flex_flight\"], hip_flex/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rhip_rot_flight\"], dataset_cleaned[\"amplitude_lhip_rot_flight\"], hip_rot/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rhip_rot_flight\"], dataset_cleaned[\"mean_lhip_rot_flight\"], hip_rot/2)),0)\n",
    "\n",
    "dataset_cleaned[\"symmetry_hip_flight\"] = dataset_cleaned[\"symmetry_hip_flight\"].clip(lower=0)\n",
    "\n",
    "dataset_cleaned[\"amplitude_rhip_add_support\"] = dataset_cleaned[\"rhip_add_max_support\"]-dataset_cleaned[\"rhip_add_min_support\"]\n",
    "dataset_cleaned[\"mean_rhip_add_support\"]=(-0.5)*(dataset_cleaned[\"rhip_add_max_support\"]+dataset_cleaned[\"rhip_add_min_support\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lhip_add_support\"] = dataset_cleaned[\"lhip_add_max_support\"]-dataset_cleaned[\"lhip_add_min_support\"]\n",
    "dataset_cleaned[\"mean_lhip_add_support\"]=(0.5)*(dataset_cleaned[\"lhip_add_max_support\"]+dataset_cleaned[\"lhip_add_min_support\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_rhip_flex_support\"] = dataset_cleaned[\"rhip_flex_max_support\"]-dataset_cleaned[\"rhip_flex_min_support\"]\n",
    "dataset_cleaned[\"mean_rhip_flex_support\"]=(0.5)*(dataset_cleaned[\"rhip_flex_max_support\"]+dataset_cleaned[\"rhip_flex_min_support\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lhip_flex_support\"] = dataset_cleaned[\"lhip_flex_max_support\"]-dataset_cleaned[\"lhip_flex_min_support\"]\n",
    "dataset_cleaned[\"mean_lhip_flex_support\"]=(0.5)*(dataset_cleaned[\"lhip_flex_max_support\"]+dataset_cleaned[\"lhip_flex_min_support\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_rhip_rot_support\"] = dataset_cleaned[\"rhip_rot_max_support\"]-dataset_cleaned[\"rhip_rot_min_support\"]\n",
    "dataset_cleaned[\"mean_rhip_rot_support\"]=(0.5)*(dataset_cleaned[\"rhip_rot_max_support\"]+dataset_cleaned[\"rhip_rot_min_support\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lhip_rot_support\"] = dataset_cleaned[\"lhip_rot_max_support\"]-dataset_cleaned[\"lhip_rot_min_support\"]\n",
    "dataset_cleaned[\"mean_lhip_rot_support\"]=(-0.5)*(dataset_cleaned[\"lhip_rot_max_support\"]+dataset_cleaned[\"lhip_rot_min_support\"])\n",
    "\n",
    "dataset_cleaned[\"symmetry_hip_support\"]= round((1/6)*(ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rhip_add_support\"], dataset_cleaned[\"amplitude_lhip_add_support\"], hip_add/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rhip_add_support\"], dataset_cleaned[\"mean_lhip_add_support\"], hip_add/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rhip_flex_support\"], dataset_cleaned[\"amplitude_lhip_flex_support\"], hip_flex/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rhip_flex_support\"], dataset_cleaned[\"mean_lhip_flex_support\"], hip_flex/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rhip_rot_support\"], dataset_cleaned[\"amplitude_lhip_rot_support\"], hip_rot/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rhip_rot_support\"], dataset_cleaned[\"mean_lhip_rot_support\"], hip_rot/2)),0)\n",
    "\n",
    "dataset_cleaned[\"symmetry_hip_support\"] = dataset_cleaned[\"symmetry_hip_support\"].clip(lower=0)\n",
    "\n",
    "dataset_cleaned = dataset_cleaned.copy()\n",
    "\n",
    "knee_val=53\n",
    "knee_flex=160\n",
    "knee_rot=70\n",
    "\n",
    "dataset_cleaned[\"amplitude_rknee_val\"] = dataset_cleaned[\"rknee_val_max_global\"]-dataset_cleaned[\"rknee_val_min_global\"]\n",
    "dataset_cleaned[\"mean_rknee_val\"]=(-0.5)*(dataset_cleaned[\"rknee_val_max_global\"]+dataset_cleaned[\"rknee_val_min_global\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lknee_val\"] = dataset_cleaned[\"lknee_val_max_global\"]-dataset_cleaned[\"lknee_val_min_global\"]\n",
    "dataset_cleaned[\"mean_lknee_val\"]=(0.5)*(dataset_cleaned[\"lknee_val_max_global\"]+dataset_cleaned[\"lknee_val_min_global\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_rknee_flex\"] = dataset_cleaned[\"rknee_flex_max_global\"]-dataset_cleaned[\"rknee_flex_min_global\"]\n",
    "dataset_cleaned[\"mean_rknee_flex\"]=(-0.5)*(dataset_cleaned[\"rknee_flex_max_global\"]+dataset_cleaned[\"rknee_flex_min_global\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lknee_flex\"] = dataset_cleaned[\"lknee_flex_max_global\"]-dataset_cleaned[\"lknee_flex_min_global\"]\n",
    "dataset_cleaned[\"mean_lknee_flex\"]=(-0.5)*(dataset_cleaned[\"lknee_flex_max_global\"]+dataset_cleaned[\"lknee_flex_min_global\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_rknee_rot\"] = dataset_cleaned[\"rknee_rot_max_global\"]-dataset_cleaned[\"rknee_rot_min_global\"]\n",
    "dataset_cleaned[\"mean_rknee_rot\"]=(0.5)*(dataset_cleaned[\"rknee_rot_max_global\"]+dataset_cleaned[\"rknee_rot_min_global\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lknee_rot\"] = dataset_cleaned[\"lknee_rot_max_global\"]-dataset_cleaned[\"lknee_rot_min_global\"]\n",
    "dataset_cleaned[\"mean_lknee_rot\"]=(-0.5)*(dataset_cleaned[\"lknee_rot_max_global\"]+dataset_cleaned[\"lknee_rot_min_global\"])\n",
    "\n",
    "dataset_cleaned[\"symmetry_knee\"]= round((1/6)*(ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rknee_val\"], dataset_cleaned[\"amplitude_lknee_val\"], knee_val/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rknee_val\"], dataset_cleaned[\"mean_lknee_val\"], knee_val/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rknee_flex\"], dataset_cleaned[\"amplitude_lknee_flex\"], knee_flex/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rknee_flex\"], dataset_cleaned[\"mean_lknee_flex\"], knee_flex/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rknee_rot\"], dataset_cleaned[\"amplitude_lknee_rot\"], knee_rot/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rknee_rot\"], dataset_cleaned[\"mean_lknee_rot\"], knee_rot/2)),0)\n",
    "\n",
    "dataset_cleaned[\"symmetry_knee\"] = dataset_cleaned[\"symmetry_knee\"].clip(lower=0)\n",
    "\n",
    "dataset_cleaned[\"amplitude_rknee_val_support\"] = dataset_cleaned[\"rknee_val_max_support\"]-dataset_cleaned[\"rknee_val_min_support\"]\n",
    "dataset_cleaned[\"mean_rknee_val_support\"]=(-0.5)*(dataset_cleaned[\"rknee_val_max_support\"]+dataset_cleaned[\"rknee_val_min_support\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lknee_val_support\"] = dataset_cleaned[\"lknee_val_max_support\"]-dataset_cleaned[\"lknee_val_min_support\"]\n",
    "dataset_cleaned[\"mean_lknee_val_support\"]=(0.5)*(dataset_cleaned[\"lknee_val_max_support\"]+dataset_cleaned[\"lknee_val_min_support\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_rknee_flex_support\"] = dataset_cleaned[\"rknee_flex_max_support\"]-dataset_cleaned[\"rknee_flex_min_support\"]\n",
    "dataset_cleaned[\"mean_rknee_flex_support\"]=(-0.5)*(dataset_cleaned[\"rknee_flex_max_support\"]+dataset_cleaned[\"rknee_flex_min_support\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lknee_flex_support\"] = dataset_cleaned[\"lknee_flex_max_support\"]-dataset_cleaned[\"lknee_flex_min_support\"]\n",
    "dataset_cleaned[\"mean_lknee_flex_support\"]=(-0.5)*(dataset_cleaned[\"lknee_flex_max_support\"]+dataset_cleaned[\"lknee_flex_min_support\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_rknee_rot_support\"] = dataset_cleaned[\"rknee_rot_max_support\"]-dataset_cleaned[\"rknee_rot_min_support\"]\n",
    "dataset_cleaned[\"mean_rknee_rot_support\"]=(0.5)*(dataset_cleaned[\"rknee_rot_max_support\"]+dataset_cleaned[\"rknee_rot_min_support\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lknee_rot_support\"] = dataset_cleaned[\"lknee_rot_max_support\"]-dataset_cleaned[\"lknee_rot_min_support\"]\n",
    "dataset_cleaned[\"mean_lknee_rot_support\"]=(-0.5)*(dataset_cleaned[\"lknee_rot_max_support\"]+dataset_cleaned[\"lknee_rot_min_support\"])\n",
    "\n",
    "dataset_cleaned[\"symmetry_knee_support\"]= round((1/6)*(ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rknee_val_support\"], dataset_cleaned[\"amplitude_lknee_val_support\"], knee_val/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rknee_val_support\"], dataset_cleaned[\"mean_lknee_val_support\"], knee_val/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rknee_flex_support\"], dataset_cleaned[\"amplitude_lknee_flex_support\"], knee_flex/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rknee_flex_support\"], dataset_cleaned[\"mean_lknee_flex_support\"], knee_flex/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rknee_rot_support\"], dataset_cleaned[\"amplitude_lknee_rot_support\"], knee_rot/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rknee_rot_support\"], dataset_cleaned[\"mean_lknee_rot_support\"], knee_rot/2)),0)\n",
    "\n",
    "dataset_cleaned[\"symmetry_knee_support\"] = dataset_cleaned[\"symmetry_knee_support\"].clip(lower=0)\n",
    "\n",
    "dataset_cleaned[\"amplitude_rknee_val_flight\"] = dataset_cleaned[\"rknee_val_max_flight\"]-dataset_cleaned[\"rknee_val_min_flight\"]\n",
    "dataset_cleaned[\"mean_rknee_val_flight\"]=(-0.5)*(dataset_cleaned[\"rknee_val_max_flight\"]+dataset_cleaned[\"rknee_val_min_flight\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lknee_val_flight\"] = dataset_cleaned[\"lknee_val_max_flight\"]-dataset_cleaned[\"lknee_val_min_flight\"]\n",
    "dataset_cleaned[\"mean_lknee_val_flight\"]=(0.5)*(dataset_cleaned[\"lknee_val_max_flight\"]+dataset_cleaned[\"lknee_val_min_flight\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_rknee_flex_flight\"] = dataset_cleaned[\"rknee_flex_max_flight\"]-dataset_cleaned[\"rknee_flex_min_flight\"]\n",
    "dataset_cleaned[\"mean_rknee_flex_flight\"]=(-0.5)*(dataset_cleaned[\"rknee_flex_max_flight\"]+dataset_cleaned[\"rknee_flex_min_flight\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lknee_flex_flight\"] = dataset_cleaned[\"lknee_flex_max_flight\"]-dataset_cleaned[\"lknee_flex_min_flight\"]\n",
    "dataset_cleaned[\"mean_lknee_flex_flight\"]=(-0.5)*(dataset_cleaned[\"lknee_flex_max_flight\"]+dataset_cleaned[\"lknee_flex_min_flight\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_rknee_rot_flight\"] = dataset_cleaned[\"rknee_rot_max_flight\"]-dataset_cleaned[\"rknee_rot_min_flight\"]\n",
    "dataset_cleaned[\"mean_rknee_rot_flight\"]=(0.5)*(dataset_cleaned[\"rknee_rot_max_flight\"]+dataset_cleaned[\"rknee_rot_min_flight\"])\n",
    "\n",
    "dataset_cleaned[\"amplitude_lknee_rot_flight\"] = dataset_cleaned[\"lknee_rot_max_flight\"]-dataset_cleaned[\"lknee_rot_min_flight\"]\n",
    "dataset_cleaned[\"mean_lknee_rot_flight\"]=(-0.5)*(dataset_cleaned[\"lknee_rot_max_flight\"]+dataset_cleaned[\"lknee_rot_min_flight\"])\n",
    "\n",
    "dataset_cleaned[\"symmetry_knee_flight\"]= round((1/6)*(ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rknee_val_flight\"], dataset_cleaned[\"amplitude_lknee_val_flight\"], knee_val/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rknee_val_flight\"], dataset_cleaned[\"mean_lknee_val_flight\"], knee_val/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rknee_flex_flight\"], dataset_cleaned[\"amplitude_lknee_flex_flight\"], knee_flex/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rknee_flex_flight\"], dataset_cleaned[\"mean_lknee_flex_flight\"], knee_flex/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"amplitude_rknee_rot_flight\"], dataset_cleaned[\"amplitude_lknee_rot_flight\"], knee_rot/2)\n",
    "                                              +ComputeSymmetryHipKnee(dataset_cleaned[\"mean_rknee_rot_flight\"], dataset_cleaned[\"mean_lknee_rot_flight\"], knee_rot/2)),0)\n",
    "\n",
    "dataset_cleaned[\"symmetry_knee_flight\"] = dataset_cleaned[\"symmetry_knee_flight\"].clip(lower=0)\n",
    "dataset_cleaned = dataset_cleaned.copy()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 435,
   "id": "b08af23f-9091-4ba9-bb91-dc2378ffda53",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Datavisualisation trainer\n",
    "summary_trainer=df_trainer_grouped.describe(include=\"all\")\n",
    "with table_trainer1:\n",
    "    display(summary_trainer)\n",
    "\n",
    "df_trainer_grouped[\"trainer_created_at\"]=pd.to_datetime(df_trainer_grouped[\"trainer_created_at\"])\n",
    "df_trainer_grouped[\"trainer_created_at\"]=df_trainer_grouped [\"trainer_created_at\"].dt.to_period(\"M\")\n",
    "df_trainer_month=df_trainer_grouped.groupby(\"trainer_created_at\").size().reset_index(name=\"nb_trainer\")\n",
    "df_trainer_month[\"cumul\"]=df_trainer_month[\"nb_trainer\"].cumsum()\n",
    "df_trainer_month[\"trainer_created_at\"]=df_trainer_month[\"trainer_created_at\"].astype(str)\n",
    "df_trainer_month[\"trainer_created_at\"]=pd.to_datetime(df_trainer_month[\"trainer_created_at\"])\n",
    "df_trainer_month=df_trainer_month.rename(columns={\"trainer_created_at\":\"month\"})\n",
    "\n",
    "with graph_trainer1:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.lineplot(data=df_trainer_month, x=\"month\", y=\"cumul\", marker='o', linestyle='-')\n",
    "    ax.set_title(\"Evolution du nombre de praticiens\", fontsize=14)\n",
    "    ax.set_xlabel(\"Mois/année\", fontsize=12)\n",
    "    ax.set_ylabel(\"Nombre de praticiens\", fontsize=12)\n",
    "    plt.xticks(rotation=45)\n",
    "    plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 436,
   "id": "0df959be-cd03-4e70-99b8-167e44ce53d1",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Datavisualisation runner\n",
    "df_unique_runners = dataset_cleaned.groupby('runner_id').first().reset_index()\n",
    "df_unique_runners_summary = df_unique_runners[[\"sex\", \"size\", \"weight\", \"age\"]].describe(include=\"all\")\n",
    "\n",
    "with table_runner1: \n",
    "    display(df_unique_runners_summary)\n",
    "\n",
    "df_runner_by_trainer = df_unique_runners.groupby('trainer_id').agg(\n",
    "    nb_runners=('runner_id', 'nunique'),\n",
    "    runner_id=('runner_id', lambda x: ', '.join(map(str, sorted(set(x)))))\n",
    ").reset_index()\n",
    "df_runner_by_trainer = df_runner_by_trainer.rename(columns={'nb_runners': 'nombre de patients'})\n",
    "\n",
    "with table_runner2:\n",
    "    display(df_runner_by_trainer)\n",
    "\n",
    "with graph_runner1:\n",
    "    fig, ax = plt.subplots(figsize=(10, 5))\n",
    "    sns.countplot(data=df_unique_runners, x=\"sex\", hue=\"sex\", palette=custom_palette_sex)\n",
    "    total = len(df_unique_runners)\n",
    "    for p in ax.patches:\n",
    "        height = p.get_height()\n",
    "        percentage = (height / total) * 100\n",
    "        ax.text(p.get_x() + p.get_width() / 2, height + 1, f'{percentage:.1f}%', \n",
    "            ha='center', fontsize=12)\n",
    "    ax.set_title(\" \", fontsize=14)\n",
    "    ax.set_xlabel(\"Sexe\", fontsize=12)\n",
    "    plt.yticks(np.arange(0, df_unique_runners[\"activity\"].value_counts().max() + 10, 5))\n",
    "    ax.set_ylabel(\"Pourcentage\")\n",
    "    plt.show()\n",
    "\n",
    "\n",
    "with graph_runner2:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.histplot(data=df_unique_runners, x=\"age\", hue=\"sex\", stat='percent', multiple='dodge', common_norm=False, ax=ax, palette=custom_palette_sex)\n",
    "    ax.set_title(\" \", fontsize=14)\n",
    "    ax.set_xlabel(\"Âge (années)\", fontsize=12)\n",
    "    ax.set_ylabel(\"Pourcentage\", fontsize=12)\n",
    "    ax.get_legend().set_title(\"Sexe\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_runner3:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.histplot(data=df_unique_runners, x=\"size\", hue=\"sex\", stat='percent', multiple='dodge', common_norm=False, ax=ax, palette=custom_palette_sex)\n",
    "    ax.set_title(\" \", fontsize=14)\n",
    "    ax.set_xlabel(\"Taille (cm)\", fontsize=12)\n",
    "    ax.set_ylabel(\"Pourcentage\", fontsize=12)\n",
    "    ax.get_legend().set_title(\"Sexe\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_runner4:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.histplot(data=df_unique_runners, x=\"weight\", hue=\"sex\", stat='percent', multiple='dodge', common_norm=False, ax=ax, palette=custom_palette_sex)\n",
    "    ax.set_title(\" \", fontsize=14)\n",
    "    ax.set_xlabel(\"Poids (kg)\", fontsize=12)\n",
    "    ax.set_ylabel(\"Pourcentage\", fontsize=12)\n",
    "    ax.get_legend().set_title(\"Sexe\")\n",
    "    plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 437,
   "id": "b0fb709a-e5c3-4d0d-9fa0-f447c91ccc73",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Datavisualisation diagnosis\n",
    "crosstab_body_region_diagnosis = pd.crosstab(dataset_cleaned['diagnosis'], \n",
    "                                             dataset_cleaned['body_region'], \n",
    "                                             margins=True, normalize='index').apply(lambda x: round(x*100,2))\n",
    "with table_diagnosis1:\n",
    "    display(crosstab_body_region_diagnosis)\n",
    "\n",
    "with graph_diagnosis1:\n",
    "    fig, ax = plt.subplots(figsize=(10, 5))\n",
    "    order_body_region = dataset_cleaned[\"body_region\"].value_counts().index\n",
    "    sns.countplot(data=dataset_cleaned, x=\"body_region\", hue=\"body_region\", order=order_body_region)\n",
    "    ax.set_title(\" \", fontsize=14)\n",
    "    ax.set_xlabel(\"Région traitée\", fontsize=12)\n",
    "    plt.yticks(np.arange(0, dataset_cleaned[\"body_region\"].value_counts().max() + 5, 5))\n",
    "    ax.set_ylabel(\"Fréquence\")\n",
    "    plt.xticks(rotation=45)\n",
    "    plt.tight_layout()\n",
    "    plt.show()\n",
    "\n",
    "with graph_diagnosis2 :\n",
    "    fig, ax = plt.subplots(figsize=(10, 5))\n",
    "    sns.countplot(data=dataset_cleaned, x=\"sex\", hue=\"body_region\")\n",
    "    ax.set_title(\" \", fontsize=14)\n",
    "    ax.set_xlabel(\"Région traitée\", fontsize=12)\n",
    "    plt.yticks(np.arange(0, dataset_cleaned[\"body_region\"].value_counts().max() + 5, 5))\n",
    "    ax.set_ylabel(\"Fréquence\")\n",
    "    plt.xticks(rotation=45)\n",
    "    plt.tight_layout()\n",
    "    ax.get_legend().set_title(\"Région traitée par sexe\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_diagnosis3 :\n",
    "    fig, ax = plt.subplots(figsize=(10, 5))\n",
    "    sns.countplot(data=dataset_cleaned, x=\"diagnosis\", hue=\"diagnosis\")\n",
    "    ax.set_title(\" \", fontsize=14)\n",
    "    ax.set_xlabel(\"Pathologies\", fontsize=12)\n",
    "    plt.yticks(np.arange(0, dataset_cleaned[\"diagnosis\"].value_counts().max() + 5, 5))\n",
    "    ax.set_ylabel(\"Fréquence\")\n",
    "    plt.xticks(rotation=90)\n",
    "    plt.tight_layout()\n",
    "    plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 438,
   "id": "a3b8e6e4-c1a9-49b5-a392-2878854ee3f0",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Datavisualisation session\n",
    "\n",
    "with graph_session1:\n",
    "    fig, ax = plt.subplots(figsize=(10, 5))\n",
    "    sns.countplot(data=dataset_cleaned, x=\"activity\", hue=\"activity\", palette=custom_palette_activity)\n",
    "    total = len(dataset_cleaned)\n",
    "    for p in ax.patches:\n",
    "        height = p.get_height()\n",
    "        percentage = (height / total) * 100\n",
    "        ax.text(p.get_x() + p.get_width() / 2, height + 1, f'{percentage:.1f}%', \n",
    "            ha='center', fontsize=12)\n",
    "    ax.set_title(\" \", fontsize=14)\n",
    "    ax.set_xlabel(\"Type d'activité\", fontsize=12)\n",
    "    plt.yticks(np.arange(0, dataset_cleaned[\"activity\"].value_counts().max() + 10, 5))\n",
    "    ax.set_ylabel(\"Fréquence\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_session2:\n",
    "    dataset_cleaned[\"feeling\"] = pd.Categorical(dataset_cleaned[\"feeling\"], ordered=True)\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.histplot(data=dataset_cleaned, x=\"feeling\", hue=\"activity\", stat='percent', multiple='dodge', common_norm=False, ax=ax, palette=custom_palette_activity)\n",
    "    ax.set_title(\" \", fontsize=14)\n",
    "    ax.set_xlabel(\"Ressenti (de 1 à 10)\", fontsize=12)\n",
    "    ax.set_ylabel(\"Pourcentage\", fontsize=12)\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_session3:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(y=\"duration_corrected\", data=dataset_cleaned, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\" \")\n",
    "    ax.set_xlabel(\"Durée des sessions (secondes)\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 439,
   "id": "e63ce9f4-ec1f-488b-8cde-2cd6f3f446fd",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Datavisualisation kinetics\n",
    "\n",
    "with graph_kinetics1:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"nb_steps\", data=dataset_cleaned, ax=axes[0], hue=\"activity\",palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Nombre de pas au total\")\n",
    "    axes[0].set_ylabel(\" \")\n",
    "    sns.boxplot(y=\"distance_corrected\", data=dataset_cleaned, ax=axes[1], hue=\"activity\",palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\" \")\n",
    "    axes[1].set_xlabel(\"Distance parcourue (m)\")\n",
    "    plt.show()\n",
    "    \n",
    "with graph_kinetics2:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"pace\", data=dataset_cleaned, ax=axes[0], hue=\"activity\",palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_ylabel(\" \")\n",
    "    axes[0].set_xlabel(\"Cadence (pas/minute)\")\n",
    "    sns.boxplot(y=\"pace_corrected\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\" \")\n",
    "    axes[1].set_xlabel(\"Cadence théorique (pas/minute)\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_kinetics3:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"speed\", data=dataset_cleaned, ax=axes[0], hue=\"activity\",palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_ylabel(\" \")\n",
    "    axes[0].set_xlabel(\"Vitesse (km/h)\")\n",
    "    sns.boxplot(y=\"speed_corrected\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\" \")\n",
    "    axes[1].set_xlabel(\"Vitesse théorique (km/h)\")\n",
    "    plt.show()\n",
    "    \n",
    "with graph_kinetics4:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"right_acc_peak\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_ylabel(\" \")\n",
    "    axes[0].set_xlabel(\"Force impact droit au sol (N)\")\n",
    "    sns.boxplot(y=\"left_acc_peak\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\" \")\n",
    "    axes[1].set_xlabel(\"Force impact gauche au sol (N)\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_kinetics5:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(y=\"symmetry_acc_peak\", data=dataset_cleaned, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\" \")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    ax.set_xlabel(\"Symétrie des impacts\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_kinetics6:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    bins=np.linspace(0,100,11)\n",
    "    sns.histplot(data=dataset_cleaned, x='symmetry_acc_peak', bins=bins, hue='activity', kde=False, stat='percent', multiple='dodge', ax=ax, palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Pourcentage de symétrie\")\n",
    "    ax.set_ylabel(\"Pourcentage d'individus\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "   \n",
    "with graph_kinetics7:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"right_vlr\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_ylabel(\" \")\n",
    "    axes[0].set_xlabel(\"Amorti droit (BW/S)\")\n",
    "    sns.boxplot(y=\"left_vlr\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\" \")\n",
    "    axes[1].set_xlabel(\"Amorti gauche (BW/S)\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_kinetics8:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(y=\"symmetry_vlr\", data=dataset_cleaned, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\" \")\n",
    "    ax.set_xlabel(\"Symétrie des amortis\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_kinetics9:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    bins=np.linspace(0,100,11)\n",
    "    sns.histplot(data=dataset_cleaned, x='symmetry_vlr', bins=bins, hue='activity', kde=False, stat='percent', multiple='dodge', ax=ax, palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Pourcentage de symétrie\")\n",
    "    ax.set_ylabel(\"Pourcentage d'individus\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "    "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 440,
   "id": "52da41ce-6f48-486e-a31e-db4ca38d0cac",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Datavisualisation spatio-temporal\n",
    "\n",
    "with graph_spatio1:\n",
    "    fig, axes = plt.subplots(1, 3, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"stride_length\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_ylabel(\" \")\n",
    "    axes[0].set_xlabel(\"Longueur d'une foulée (m)\")\n",
    "    sns.boxplot(y=\"right_step_length\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\" \")\n",
    "    axes[1].set_xlabel(\"Longueur du pas droit (m)\")\n",
    "    sns.boxplot(y=\"left_step_length\", data=dataset_cleaned, ax=axes[2], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[2].set_title(\" \")\n",
    "    axes[2].set_ylabel(\" \")\n",
    "    axes[2].set_xlabel(\"Longueur du pas gauche (m)\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_spatio2:\n",
    "    fig, axes = plt.subplots(1, 3, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"stride_duration\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_ylabel(\" \")\n",
    "    axes[0].set_xlabel(\"Durée d'une foulée (s)\")\n",
    "    sns.boxplot(y=\"right_step_duration\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\" \")\n",
    "    axes[1].set_xlabel(\"Durée du pas droit (s)\")\n",
    "    sns.boxplot(y=\"left_step_duration\", data=dataset_cleaned, ax=axes[2], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[2].set_title(\" \")\n",
    "    axes[2].set_ylabel(\" \")\n",
    "    axes[2].set_xlabel(\"Durée du pas gauche (s)\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_spatio3: \n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"symmetry_step_length\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\"\")\n",
    "    axes[0].set_ylabel(\" \")\n",
    "    axes[0].set_xlabel(\"Symétrie de la longueur des pas\")\n",
    "    sns.boxplot(y=\"symmetry_step_duration\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\" \")\n",
    "    axes[1].set_xlabel(\"Symétrie de la durée des pas\")\n",
    "\n",
    "\n",
    "with graph_spatio4:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(y=\"symmetry_step\", data=dataset_cleaned, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\" \")\n",
    "    ax.set_xlabel(\"Symétrie des pas (moyenne des 2 symétries précédentes)\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_spatio5:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    bins=np.linspace(0,100,11)\n",
    "    sns.histplot(data=dataset_cleaned, x='symmetry_step', bins=bins, hue='activity', kde=False, stat='percent', multiple='dodge', ax=ax, palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Pourcentage de symétrie\")\n",
    "    ax.set_ylabel(\"Pourcentage d'individus\")\n",
    "    ax.get_legend().set_title(\"Sexe\")\n",
    "    plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 441,
   "id": "cab481fc-a9a5-4514-9919-ad26513f4ce1",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Datavisualisation pelvis\n",
    "\n",
    "with graph_pelvis1:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(y=\"symmetry_pelvis\", data=dataset_cleaned, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Symétrie du bassin (global)\")\n",
    "    ax.set_ylabel(\" \")\n",
    "    ax.get_legend().set_title(\"Sexe\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_pelvis2:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    bins=np.linspace(0,100,11)\n",
    "    sns.histplot(data=dataset_cleaned, x='symmetry_pelvis', bins=bins, hue='activity', kde=False, stat='percent', multiple='dodge', ax=ax, palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Pourcentage de symétrie (global)\")\n",
    "    ax.set_ylabel(\"Pourcentage d'individus\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_pelvis3:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(y=\"symmetry_pelvis_support\", data=dataset_cleaned, hue=\"activity\",palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Symétrie du bassin (phase d'appui)\")\n",
    "    ax.set_ylabel(\" \")\n",
    "    ax.get_legend().set_title(\"Sexe\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_pelvis4:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    bins=np.linspace(0,100,11)\n",
    "    sns.histplot(data=dataset_cleaned, x='symmetry_pelvis_support', bins=bins, hue='activity', kde=False, stat='percent', multiple='dodge', ax=ax, palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Pourcentage de symétrie (phase d'appui)\")\n",
    "    ax.set_ylabel(\"Pourcentage d'individus\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_pelvis5:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(y=\"symmetry_pelvis_flight\", data=dataset_cleaned, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Symétrie du bassin (phase oscillante)\")\n",
    "    ax.set_ylabel(\" \")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_pelvis6:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    bins=np.linspace(0,100,11)\n",
    "    sns.histplot(data=dataset_cleaned, x='symmetry_pelvis_flight', bins=bins, hue='activity', kde=False, stat='percent', multiple='dodge', ax=ax, palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Pourcentage de symétrie (phase oscillante)\")\n",
    "    ax.set_ylabel(\"Pourcentage d'individus\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_pelvis7:\n",
    "    fig, axes = plt.subplots(1, 3, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"pelvis_inc_min_global\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_ylabel(\" \")\n",
    "    axes[0].set_xlabel(\"Global\")\n",
    "    sns.boxplot(y=\"pelvis_inc_min_support\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\" \")\n",
    "    axes[1].set_xlabel(\"Phase d'appui\")\n",
    "    sns.boxplot(y=\"pelvis_inc_min_flight\", data=dataset_cleaned, ax=axes[2],hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[2].set_title(\" \")\n",
    "    axes[2].set_ylabel(\" \")\n",
    "    axes[2].set_xlabel(\"Phase oscillante\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_pelvis8:\n",
    "    fig, axes = plt.subplots(1, 3, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"pelvis_inc_max_global\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_ylabel(\" \")\n",
    "    axes[0].set_xlabel(\"Global\")\n",
    "    sns.boxplot(y=\"pelvis_inc_max_support\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\" \")\n",
    "    axes[1].set_xlabel(\"Phase d'appui\")\n",
    "    sns.boxplot(y=\"pelvis_inc_max_flight\", data=dataset_cleaned, ax=axes[2],hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[2].set_title(\" \")\n",
    "    axes[2].set_ylabel(\" \")\n",
    "    axes[2].set_xlabel(\"Phase oscillante\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_pelvis9:\n",
    "    fig, axes = plt.subplots(1, 3, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"pelvis_ver_min_global\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_ylabel(\" \")\n",
    "    axes[0].set_xlabel(\"Global\")\n",
    "    sns.boxplot(y=\"pelvis_ver_min_support\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\" \")\n",
    "    axes[1].set_xlabel(\"Phase d'appui\")\n",
    "    sns.boxplot(y=\"pelvis_ver_min_flight\", data=dataset_cleaned, ax=axes[2],hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[2].set_title(\" \")\n",
    "    axes[2].set_ylabel(\" \")\n",
    "    axes[2].set_xlabel(\"Phase oscillante\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_pelvis10:\n",
    "    fig, axes = plt.subplots(1, 3, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"pelvis_ver_max_global\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_ylabel(\" \")\n",
    "    axes[0].set_xlabel(\"Global\")\n",
    "    sns.boxplot(y=\"pelvis_ver_max_support\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\" \")\n",
    "    axes[1].set_xlabel(\"Phase d'appui\")\n",
    "    sns.boxplot(y=\"pelvis_ver_max_flight\", data=dataset_cleaned, ax=axes[2],hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[2].set_title(\" \")\n",
    "    axes[2].set_ylabel(\" \")\n",
    "    axes[2].set_xlabel(\"Phase oscillante\")\n",
    "    plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 442,
   "id": "049c1fa9-31e3-4841-a63c-088e509f7f56",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Datavisualisation hips\n",
    "\n",
    "with graph_hips1:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(y=\"symmetry_hip\", data=dataset_cleaned, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\" \")\n",
    "    ax.set_xlabel(\"Symétrie des hanches\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips2:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    bins=np.linspace(0,100,11)\n",
    "    sns.histplot(data=dataset_cleaned, x='symmetry_hip', bins=bins, hue='activity', kde=False, stat='percent', multiple='dodge', ax=ax, palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Pourcentage de symétrie (global)\")\n",
    "    ax.set_ylabel(\"Pourcentage d'individus\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips3:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rhip_add\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    axes[0].set_ylabel(\"Amplitude adduction/abduction\")\n",
    "    sns.boxplot(y=\"amplitude_lhip_add\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Amplitude adduction/abduction\")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips4:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rhip_add\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    axes[0].set_ylabel(\"Moyenne adduction/abduction\")\n",
    "    sns.boxplot(y=\"mean_lhip_add\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    axes[1].set_ylabel(\"Moyenne adduction/abduction\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips5:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rhip_flex\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_ylabel(\"Amplitude flexion\")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    sns.boxplot(y=\"amplitude_lhip_flex\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    axes[1].set_ylabel(\"Amplitude flexion\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips6:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rhip_flex\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    axes[0].set_ylabel(\"Moyenne flexion\")\n",
    "    sns.boxplot(y=\"mean_lhip_flex\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Moyenne flexion\")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips7:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rhip_rot\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    axes[0].set_ylabel(\"Amplitude rotation\")\n",
    "    sns.boxplot(y=\"amplitude_lhip_rot\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    axes[1].set_ylabel(\"Amplitude rotation\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips8:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rhip_rot\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    axes[0].set_ylabel(\"Moyenne rotation\")\n",
    "    sns.boxplot(y=\"mean_lhip_rot\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    axes[1].set_ylabel(\"Moyenne rotation\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips9:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(y=\"symmetry_hip_support\", data=dataset_cleaned, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\" \")\n",
    "    ax.set_xlabel(\"Symétrie des hanches (phase d'appui)\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips10:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    bins=np.linspace(0,100,11)\n",
    "    sns.histplot(data=dataset_cleaned, x='symmetry_hip_support', bins=bins, hue='activity', kde=False, stat='percent', multiple='dodge', ax=ax, palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Pourcentage de symétrie (phase d'appui)\")\n",
    "    ax.set_ylabel(\"Pourcentage d'individus\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips11:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rhip_add_support\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    axes[0].set_ylabel(\"Amplitude adduction/abduction\")\n",
    "    sns.boxplot(y=\"amplitude_lhip_add_support\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Amplitude adduction/abduction\")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips12:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rhip_add_support\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    axes[0].set_ylabel(\"Moyenne adduction/abduction\")\n",
    "    sns.boxplot(y=\"mean_lhip_add_support\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    axes[1].set_ylabel(\"Moyenne adduction/abduction\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips13:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rhip_flex_support\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_ylabel(\"Amplitude flexion\")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    sns.boxplot(y=\"amplitude_lhip_flex_support\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    axes[1].set_ylabel(\"Amplitude flexion\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips14:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rhip_flex_support\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    axes[0].set_ylabel(\"Moyenne flexion\")\n",
    "    sns.boxplot(y=\"mean_lhip_flex_support\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Moyenne flexion\")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips15:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rhip_rot_support\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    axes[0].set_ylabel(\"Amplitude rotation\")\n",
    "    sns.boxplot(y=\"amplitude_lhip_rot_support\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    axes[1].set_ylabel(\"Amplitude rotation\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips16:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rhip_rot_support\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    axes[0].set_ylabel(\"Moyenne rotation\")\n",
    "    sns.boxplot(y=\"mean_lhip_rot_support\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    axes[1].set_ylabel(\"Moyenne rotation\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips17:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(y=\"symmetry_hip_flight\", data=dataset_cleaned, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\" \")\n",
    "    ax.set_xlabel(\"Symétrie des hanches (phase oscillante)\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips18:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    bins=np.linspace(0,100,11)\n",
    "    sns.histplot(data=dataset_cleaned, x='symmetry_hip_flight', bins=bins, hue='activity', kde=False, stat='percent', multiple='dodge', ax=ax, palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Pourcentage de symétrie (phase oscillante)\")\n",
    "    ax.set_ylabel(\"Pourcentage d'individus\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips19:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rhip_add_flight\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    axes[0].set_ylabel(\"Amplitude adduction/abduction\")\n",
    "    sns.boxplot(y=\"amplitude_lhip_add_flight\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Amplitude adduction/abduction\")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips20:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rhip_add_flight\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    axes[0].set_ylabel(\"Moyenne adduction/abduction\")\n",
    "    sns.boxplot(y=\"mean_lhip_add_flight\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    axes[1].set_ylabel(\"Moyenne adduction/abduction\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips21:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rhip_flex_flight\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_ylabel(\"Amplitude flexion\")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    sns.boxplot(y=\"amplitude_lhip_flex_flight\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    axes[1].set_ylabel(\"Amplitude flexion\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips22:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rhip_flex_flight\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    axes[0].set_ylabel(\"Moyenne flexion\")\n",
    "    sns.boxplot(y=\"mean_lhip_flex_flight\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Moyenne flexion\")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips23:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rhip_rot_flight\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    axes[0].set_ylabel(\"Amplitude rotation\")\n",
    "    sns.boxplot(y=\"amplitude_lhip_rot_flight\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    axes[1].set_ylabel(\"Amplitude rotation\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_hips24:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rhip_rot_flight\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Hanche droite\")\n",
    "    axes[0].set_ylabel(\"Moyenne rotation\")\n",
    "    sns.boxplot(y=\"mean_lhip_rot_flight\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Hanche gauche\")\n",
    "    axes[1].set_ylabel(\"Moyenne rotation\")\n",
    "    plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 443,
   "id": "122921a4-a768-4bfa-9e77-655ca3d20896",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Datavisualisation knee\n",
    "\n",
    "with graph_knee1:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(y=\"symmetry_knee\", data=dataset_cleaned, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\" \")\n",
    "    ax.set_xlabel(\"Symétrie des genoux globale\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee2:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    bins=np.linspace(0,100,11)\n",
    "    sns.histplot(data=dataset_cleaned, x='symmetry_knee', bins=bins, hue='activity', kde=False, stat='percent', multiple='dodge', ax=ax, palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Pourcentage de symétrie (global)\")\n",
    "    ax.set_ylabel(\"Pourcentage d'individus\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee3:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rknee_val\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Amplitude valgus\")\n",
    "    sns.boxplot(y=\"amplitude_lknee_val\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Amplitude valgus\")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee4:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rknee_val\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Moyenne valgus\")\n",
    "    sns.boxplot(y=\"mean_lknee_val\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    axes[1].set_ylabel(\"Moyenne valgus\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee5:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rknee_flex\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Amplitude flexion\")\n",
    "    sns.boxplot(y=\"amplitude_lknee_flex\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Amplitude flexion\")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee6:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rknee_flex\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Moyenne flexion\")\n",
    "    sns.boxplot(y=\"mean_lknee_flex\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    axes[1].set_ylabel(\"Moyenne flexion\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee7:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rknee_rot\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Amplitude rotation\")\n",
    "    sns.boxplot(y=\"amplitude_lknee_rot\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Amplitude rotation\")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee8:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rknee_rot\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Moyenne rotation\")\n",
    "    sns.boxplot(y=\"mean_lknee_rot\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    axes[1].set_ylabel(\"Moyenne rotation\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee9:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(y=\"symmetry_knee_support\", data=dataset_cleaned, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\" \")\n",
    "    ax.set_xlabel(\"Symétrie des genoux en phase d'appui\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee10:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    bins=np.linspace(0,100,11)\n",
    "    sns.histplot(data=dataset_cleaned, x='symmetry_knee_support', bins=bins, hue='activity', kde=False, stat='percent', multiple='dodge', ax=ax, palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Pourcentage de symétrie (phase d'appui)\")\n",
    "    ax.set_ylabel(\"Pourcentage d'individus\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee11:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rknee_val_support\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Amplitude valgus\")\n",
    "    sns.boxplot(y=\"amplitude_lknee_val_support\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Amplitude valgus\")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee12:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rknee_val_support\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Moyenne valgus\")\n",
    "    sns.boxplot(y=\"mean_lknee_val_support\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    axes[1].set_ylabel(\"Moyenne valgus\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee13:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rknee_flex_support\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Amplitude flexion\")\n",
    "    sns.boxplot(y=\"amplitude_lknee_flex_support\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Amplitude flexion\")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee14:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rknee_flex_support\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Moyenne flexion\")\n",
    "    sns.boxplot(y=\"mean_lknee_flex_support\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    axes[1].set_ylabel(\"Moyenne flexion\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee15:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rknee_rot_support\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Amplitude rotation\")\n",
    "    sns.boxplot(y=\"amplitude_lknee_rot_support\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Amplitude rotation\")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee16:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rknee_rot_support\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Moyenne rotation\")\n",
    "    sns.boxplot(y=\"mean_lknee_rot_support\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    axes[1].set_ylabel(\"Moyenne rotation\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee17:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(y=\"symmetry_knee_flight\", data=dataset_cleaned, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\" \")\n",
    "    ax.set_xlabel(\"Symétrie des genoux en phase oscillante\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee18:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    bins=np.linspace(0,100,11)\n",
    "    sns.histplot(data=dataset_cleaned, x='symmetry_knee_flight', bins=bins, hue='activity', kde=False, stat='percent', multiple='dodge', ax=ax, palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Pourcentage de symétrie (en phase oscillante)\")\n",
    "    ax.set_ylabel(\"Pourcentage d'individus\")\n",
    "    ax.get_legend().set_title(\"Activité\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee19:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rknee_val_flight\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Amplitude valgus\")\n",
    "    sns.boxplot(y=\"amplitude_lknee_val_flight\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Amplitude valgus\")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee20:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rknee_val_flight\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Moyenne valgus\")\n",
    "    sns.boxplot(y=\"mean_lknee_val_flight\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    axes[1].set_ylabel(\"Moyenne valgus\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee21:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rknee_flex_flight\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Amplitude flexion\")\n",
    "    sns.boxplot(y=\"amplitude_lknee_flex_flight\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Amplitude flexion\")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee22:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rknee_flex_flight\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Moyenne flexion\")\n",
    "    sns.boxplot(y=\"mean_lknee_flex_flight\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    axes[1].set_ylabel(\"Moyenne flexion\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee23:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"amplitude_rknee_rot_flight\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Amplitude rotation\")\n",
    "    sns.boxplot(y=\"amplitude_lknee_rot_flight\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Amplitude rotation\")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_knee24:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.boxplot(y=\"mean_rknee_rot_flight\", data=dataset_cleaned, ax=axes[0], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Genou droit\")\n",
    "    axes[0].set_ylabel(\"Moyenne rotation\")\n",
    "    sns.boxplot(y=\"mean_lknee_rot_flight\", data=dataset_cleaned, ax=axes[1], hue=\"activity\", palette=custom_palette_activity)\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_xlabel(\"Genou gauche\")\n",
    "    axes[1].set_ylabel(\"Moyenne rotation\")\n",
    "    plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 444,
   "id": "8e64c2da-1ff0-4627-8950-0e09ce7182a9",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Statistics\n",
    "\n",
    "crosstab_sex_diagnosis = pd.crosstab(dataset_cleaned['sex'], \n",
    "                                             dataset_cleaned['diagnosis_body_region'], \n",
    "                                             margins=True, normalize='index').apply(lambda x: round(x*100,2))\n",
    "\n",
    "with table_stats1:\n",
    "    display(crosstab_sex_diagnosis)\n",
    "\n",
    "contingency_table_sex_diagnosis = pd.crosstab(dataset_cleaned['diagnosis_body_region'], dataset_cleaned['sex'])\n",
    "chi2, p, dof, expected = chi2_contingency(contingency_table_sex_diagnosis)\n",
    "n = contingency_table_sex_diagnosis.sum().sum()\n",
    "phi2 = chi2 / n\n",
    "r, k = contingency_table_sex_diagnosis.shape\n",
    "cramers_v = np.sqrt(phi2 / min(k-1, r-1))\n",
    "\n",
    "with content_stats1:\n",
    "    display (f\"Khi2: {chi2}, P Value: {p}, Coefficient de Cramér: {cramers_v}\")\n",
    "\n",
    "with graph_stats1:\n",
    "    medians = dataset_cleaned.groupby('diagnosis_body_region')['age'].median().sort_values()\n",
    "    ordered_categories = medians.index\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(x='diagnosis_body_region', y='age', data=dataset_cleaned, order=ordered_categories)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Age\")\n",
    "    ax.set_xlabel(\" \")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "    \n",
    "with graph_stats2:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    dataset_cleaned[\"age_group\"]=pd.cut(dataset_cleaned[\"age\"], bins=[10,20,30,40,50,60,70, 80,90, 100], labels=[\"10-20\", '21-30', '31-40','41-50', '51-60', '61-70', '71-80', '81-90', '91-100'])\n",
    "    sns.countplot(data=dataset_cleaned, x='age_group', hue='diagnosis_body_region', palette='tab20')\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Tranche d'âge\")\n",
    "    ax.set_ylabel(\"Nombre de cas\")\n",
    "    ax.legend(title=\"Pathologie\", bbox_to_anchor=(1.05, 1), loc='upper left')\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats3:\n",
    "    medians = dataset_cleaned.groupby('diagnosis_body_region')['size'].median().sort_values()\n",
    "    ordered_categories = medians.index\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(x='diagnosis_body_region', y='size', data=dataset_cleaned, order=ordered_categories)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Taille\")\n",
    "    ax.set_xlabel(\" \")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "    \n",
    "with graph_stats4:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    dataset_cleaned[\"size_group\"]=pd.cut(dataset_cleaned[\"size\"], bins=[140,150,160,170,180,190,200], labels=[\"140-150\", '151-160', '161-170','171-180', '181-190', '191-200'])\n",
    "    sns.countplot(data=dataset_cleaned, x='size_group', hue='diagnosis_body_region', palette='tab20')\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Taille\")\n",
    "    ax.set_ylabel(\"Nombre de cas\")\n",
    "    ax.legend(title=\"Pathologie\", bbox_to_anchor=(1.05, 1), loc='upper left')\n",
    "    plt.show()\n",
    "\n",
    "\n",
    "with graph_stats5:\n",
    "    medians = dataset_cleaned.groupby('diagnosis_body_region')['weight'].median().sort_values()\n",
    "    ordered_categories = medians.index\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(x='diagnosis_body_region', y='weight', data=dataset_cleaned, order=ordered_categories)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Poids\")\n",
    "    ax.set_xlabel(\" \")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "    \n",
    "with graph_stats6:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    dataset_cleaned[\"weight_group\"]=pd.cut(dataset_cleaned[\"weight\"], bins=[40,50,60,70,80,90,100, 110, 120], labels=[\"40-50\", '51-60', '61-70','71-80', '81-90', '91-100', '101-110', '111-120'])\n",
    "    sns.countplot(data=dataset_cleaned, x='weight_group', hue='diagnosis_body_region', palette='tab20')\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Poids\")\n",
    "    ax.set_ylabel(\"Nombre de cas\")\n",
    "    ax.legend(title=\"Pathologie\", bbox_to_anchor=(1.05, 1), loc='upper left')\n",
    "    plt.show()\n",
    "\n",
    "\n",
    "with graph_stats7:\n",
    "    dataset_cleaned['feeling'] = pd.to_numeric(dataset_cleaned['feeling'], errors='coerce')\n",
    "    medians = dataset_cleaned.groupby('diagnosis_body_region')['feeling'].median().sort_values()\n",
    "    ordered_categories = medians.index\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(x='diagnosis_body_region', y='feeling', data=dataset_cleaned, order=ordered_categories)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Ressenti\")\n",
    "    ax.set_xlabel(\" \")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "    \n",
    "with graph_stats8:\n",
    "    dataset_cleaned['feeling'] = dataset_cleaned['feeling'].astype('category')\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.countplot(data=dataset_cleaned, x='feeling', hue='diagnosis_body_region', palette='tab20')\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Ressenti\")\n",
    "    ax.set_ylabel(\"Nombre de cas\")\n",
    "    ax.legend(title=\"Pathologie\", bbox_to_anchor=(1.05, 1), loc='upper left')\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats9:\n",
    "    medians = dataset_cleaned.groupby('diagnosis_body_region')['pace_corrected'].median().sort_values()\n",
    "    ordered_categories = medians.index\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(x='diagnosis_body_region', y='pace_corrected', data=dataset_cleaned, order=ordered_categories, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Cadence(pas/min)\")\n",
    "    ax.set_xlabel(\" \")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "    \n",
    "with graph_stats10:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    dataset_cleaned[\"pace_corrected_group\"]=pd.cut(dataset_cleaned[\"pace_corrected\"], bins=[40, 60, 80, 100, 120, 140, 160, 180, 200, 220, 240], labels=[\"40-60\", '61-80', '81-100','101-120', '121-140', '141-160', '161-180', '181-200', '201-220','221-240'])\n",
    "    sns.countplot(data=dataset_cleaned, x='pace_corrected_group', hue='diagnosis_body_region', palette='tab20')\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Cadence(pas/min)\")\n",
    "    ax.set_ylabel(\"Nombre de cas\")\n",
    "    ax.legend(title=\"Pathologie\", bbox_to_anchor=(1.05, 1), loc='upper left')\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats11:\n",
    "    medians = dataset_cleaned.groupby('diagnosis_body_region')['stride_duration'].median().sort_values()\n",
    "    ordered_categories = medians.index\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(x='diagnosis_body_region', y='stride_duration', data=dataset_cleaned, order=ordered_categories, hue=\"activity\", palette = custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Durée de la foulée\")\n",
    "    ax.set_xlabel(\" \")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "    \n",
    "with graph_stats12:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    dataset_cleaned[\"stride_duration_group\"]=pd.cut(dataset_cleaned[\"stride_duration\"], bins=[0.4, 0.6, 0.8, 1, 1.2, 1.4, 1.6, 1.8, 2, 2.2, 2.4, 2.6, 2.8], labels=[\"0.4-0.6\", \"0.6-0.8\", \"0.8-1\", \"1-1.2\", \"1.2-1.4\", \"1.4-1.6\", \"1.6-1.8\", \"1.8-2\", \"2-2.2\", \"2.2-2.4\", \"2.4-2.6\", \"2.6-2.8\"])\n",
    "    sns.countplot(data=dataset_cleaned, x='stride_duration_group', hue='diagnosis_body_region', palette='tab20')\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Durée de la foulée\")\n",
    "    ax.set_ylabel(\"Nombre de cas\")\n",
    "    ax.legend(title=\"Pathologie\", bbox_to_anchor=(1.05, 1), loc='upper left')\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats13:\n",
    "    medians = dataset_cleaned.groupby('diagnosis_body_region')['stride_length'].median().sort_values()\n",
    "    ordered_categories = medians.index\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(x='diagnosis_body_region', y='stride_length', data=dataset_cleaned, order=ordered_categories, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Longueur de la foulée\")\n",
    "    ax.set_xlabel(\" \")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "    \n",
    "with graph_stats14:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    dataset_cleaned[\"stride_length_group\"]=pd.cut(dataset_cleaned[\"stride_length\"], bins=[0.4, 0.6, 0.8, 1, 1.2, 1.4, 1.6, 1.8, 2, 2.2, 2.4, 2.6 ], labels=[\"0.4-0.6\", \"0.6-0.8\", \"0.8-1\", \"1-1.2\", \"1.2-1.4\", \"1.4-1.6\", \"1.6-1.8\", \"1.8-2\", \"2-2.2\", \"2.2-2.4\", \"2.4-2.6\"])\n",
    "    sns.countplot(data=dataset_cleaned, x='stride_length_group', hue='diagnosis_body_region', palette='tab20')\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Longueur de la foulée\")\n",
    "    ax.set_ylabel(\"Nombre de cas\")\n",
    "    ax.legend(title=\"Pathologie\", bbox_to_anchor=(1.05, 1), loc='upper left')\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats15:\n",
    "    medians = dataset_cleaned.groupby('diagnosis_body_region')['symmetry_step'].median().sort_values()\n",
    "    ordered_categories = medians.index\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(x='diagnosis_body_region', y='symmetry_step', data=dataset_cleaned, order=ordered_categories, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Symétrie des pas\")\n",
    "    ax.set_xlabel(\" \")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "    \n",
    "with graph_stats16:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    dataset_cleaned[\"symmetry_step_group\"]=pd.cut(dataset_cleaned[\"symmetry_step\"], bins=[10,20,30,40,50,60,70, 80,90, 100], labels=[\"10-20\", '21-30', '31-40','41-50', '51-60', '61-70', '71-80', '81-90', '91-100'])\n",
    "    sns.countplot(data=dataset_cleaned, x='symmetry_step_group', hue='diagnosis_body_region', palette='tab20')\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Symmetrie des pas\")\n",
    "    ax.set_ylabel(\"Nombre de cas\")\n",
    "    ax.legend(title=\"Pathologie\", bbox_to_anchor=(1.05, 1), loc='upper left')\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats17:\n",
    "    medians = dataset_cleaned.groupby('diagnosis_body_region')['symmetry_acc_peak'].median().sort_values()\n",
    "    ordered_categories = medians.index\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(x='diagnosis_body_region', y='symmetry_acc_peak', data=dataset_cleaned, order=ordered_categories, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Symétrie des impacts\")\n",
    "    ax.set_xlabel(\" \")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "    \n",
    "with graph_stats18:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    dataset_cleaned[\"symmetry_acc_peak_group\"]=pd.cut(dataset_cleaned[\"symmetry_acc_peak\"], bins=[10,20,30,40,50,60,70, 80,90, 100], labels=[\"10-20\", '21-30', '31-40','41-50', '51-60', '61-70', '71-80', '81-90', '91-100'])\n",
    "    sns.countplot(data=dataset_cleaned, x='symmetry_acc_peak_group', hue='diagnosis', palette='tab20')\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Symmetrie des impacts\")\n",
    "    ax.set_ylabel(\"Nombre de cas\")\n",
    "    ax.legend(title=\"Pathologie\", bbox_to_anchor=(1.05, 1), loc='upper left')\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats19:\n",
    "    medians = dataset_cleaned.groupby('diagnosis_body_region')['symmetry_vlr'].median().sort_values()\n",
    "    ordered_categories = medians.index\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(x='diagnosis_body_region', y='symmetry_vlr', data=dataset_cleaned, order=ordered_categories, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Symétrie des amortis\")\n",
    "    ax.set_xlabel(\" \")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "    \n",
    "with graph_stats20:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    dataset_cleaned[\"symmetry_vlr_group\"]=pd.cut(dataset_cleaned[\"symmetry_vlr\"], bins=[10,20,30,40,50,60,70, 80,90, 100], labels=[\"10-20\", '21-30', '31-40','41-50', '51-60', '61-70', '71-80', '81-90', '91-100'])\n",
    "    sns.countplot(data=dataset_cleaned, x='symmetry_vlr_group', hue='diagnosis', palette='tab20')\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Symmetrie des amortis\")\n",
    "    ax.set_ylabel(\"Nombre de cas\")\n",
    "    ax.legend(title=\"Pathologie\", bbox_to_anchor=(1.05, 1), loc='upper left')\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats21:\n",
    "    medians = dataset_cleaned.groupby('diagnosis_body_region')['symmetry_pelvis'].median().sort_values()\n",
    "    ordered_categories = medians.index\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(x='diagnosis_body_region', y='symmetry_pelvis', data=dataset_cleaned, order=ordered_categories, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Symétrie du bassin\")\n",
    "    ax.set_xlabel(\" \")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "    \n",
    "with graph_stats22:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    dataset_cleaned[\"symmetry_pelvis_group\"]=pd.cut(dataset_cleaned[\"symmetry_pelvis\"], bins=[10,20,30,40,50,60,70, 80,90, 100], labels=[\"10-20\", '21-30', '31-40','41-50', '51-60', '61-70', '71-80', '81-90', '91-100'])\n",
    "    sns.countplot(data=dataset_cleaned, x='symmetry_pelvis_group', hue='diagnosis', palette='tab20')\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Symmetrie du bassin\")\n",
    "    ax.set_ylabel(\"Nombre de cas\")\n",
    "    ax.legend(title=\"Pathologie\", bbox_to_anchor=(1.05, 1), loc='upper left')\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats23:\n",
    "    medians = dataset_cleaned.groupby('diagnosis_body_region')['symmetry_hip'].median().sort_values()\n",
    "    ordered_categories = medians.index\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(x='diagnosis_body_region', y='symmetry_hip', data=dataset_cleaned, order=ordered_categories, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Symétrie des hanches\")\n",
    "    ax.set_xlabel(\" \")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "    \n",
    "with graph_stats24:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    dataset_cleaned[\"symmetry_hip_group\"]=pd.cut(dataset_cleaned[\"symmetry_hip\"], bins=[10,20,30,40,50,60,70, 80,90, 100], labels=[\"10-20\", '21-30', '31-40','41-50', '51-60', '61-70', '71-80', '81-90', '91-100'])\n",
    "    sns.countplot(data=dataset_cleaned, x='symmetry_hip_group', hue='diagnosis', palette='tab20')\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Symmetrie des hanches\")\n",
    "    ax.set_ylabel(\"Nombre de cas\")\n",
    "    ax.legend(title=\"Pathologie\", bbox_to_anchor=(1.05, 1), loc='upper left')\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats25:\n",
    "    medians = dataset_cleaned.groupby('diagnosis_body_region')['symmetry_knee'].median().sort_values()\n",
    "    ordered_categories = medians.index\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.boxplot(x='diagnosis_body_region', y='symmetry_knee', data=dataset_cleaned, order=ordered_categories, hue=\"activity\", palette=custom_palette_activity)\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Symétrie des genoux\")\n",
    "    ax.set_xlabel(\" \")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "    \n",
    "with graph_stats26:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    dataset_cleaned[\"symmetry_knee_group\"]=pd.cut(dataset_cleaned[\"symmetry_knee\"], bins=[10,20,30,40,50,60,70, 80,90, 100], labels=[\"10-20\", '21-30', '31-40','41-50', '51-60', '61-70', '71-80', '81-90', '91-100'])\n",
    "    sns.countplot(data=dataset_cleaned, x='symmetry_knee_group', hue='diagnosis', palette='tab20')\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_xlabel(\"Symmetrie des genoux\")\n",
    "    ax.set_ylabel(\"Nombre de cas\")\n",
    "    ax.legend(title=\"Pathologie\", bbox_to_anchor=(1.05, 1), loc='upper left')\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats27:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.regplot(data=dataset_cleaned, x='pace_corrected', y='stride_length', ci=None, scatter_kws={\"s\": 50}, line_kws={\"color\": \"red\"})\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Longueur de foulée (m)\")\n",
    "    ax.set_xlabel(\"Cadence (pas/min)\")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "    \n",
    "with graph_stats28:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.regplot(data=dataset_cleaned, x='pace_corrected', y='stride_duration', ci=None, scatter_kws={\"s\": 50}, line_kws={\"color\": \"red\"})\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Durée de foulée (s)\")\n",
    "    ax.set_xlabel(\"Cadence (pas/min)\")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats29:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.regplot(data=dataset_cleaned, x='pace_corrected', y='right_acc_peak', ci=None, scatter_kws={\"s\": 50}, line_kws={\"color\": \"red\"})\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Force d'impact à droite (N)\")\n",
    "    ax.set_xlabel(\"Cadence (pas/min)\")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "    \n",
    "with graph_stats30:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.regplot(data=dataset_cleaned, x='pace_corrected', y='left_acc_peak', ci=None, scatter_kws={\"s\": 50}, line_kws={\"color\": \"red\"})\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Force d'impact à gauche (N)\")\n",
    "    ax.set_xlabel(\"Cadence (pas/min)\")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats31:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.regplot(data=dataset_cleaned, x='stride_duration', y='right_acc_peak', ci=None, scatter_kws={\"s\": 50}, line_kws={\"color\": \"red\"}, ax=axes[0])\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Durée de foulée (s)\")\n",
    "    axes[0].set_ylabel(\"Force d'impact à droite (N)\")\n",
    "    sns.regplot(data=dataset_cleaned, x='stride_duration', y='left_acc_peak', ci=None, scatter_kws={\"s\": 50}, line_kws={\"color\": \"red\"}, ax=axes[1])\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Force d'impact à gauche (N)\")\n",
    "    axes[1].set_xlabel(\"Durée de foulée (s)\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats32:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.regplot(data=dataset_cleaned, x='stride_length', y='right_acc_peak', ci=None, scatter_kws={\"s\": 50}, line_kws={\"color\": \"red\"},ax=axes[0])\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Longueur de foulée (m)\")\n",
    "    axes[0].set_ylabel(\"Force d'impact à droite (N)\")\n",
    "    sns.regplot(data=dataset_cleaned, x='stride_length', y='left_acc_peak', ci=None, scatter_kws={\"s\": 50}, line_kws={\"color\": \"red\"}, ax=axes[1])\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Force d'impact à gauche (N)\")\n",
    "    axes[1].set_xlabel(\"Longueur de foulée (m)\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats33:\n",
    "    fig, ax = plt.subplots(figsize=(8, 5))\n",
    "    sns.regplot(data=dataset_cleaned, x='stride_duration', y='stride_length', ci=None, scatter_kws={\"s\": 50}, line_kws={\"color\": \"red\"})\n",
    "    ax.set_title(\" \")\n",
    "    ax.set_ylabel(\"Longueur de foulée (m)\")\n",
    "    ax.set_xlabel(\"Durée de foulée (s)\")\n",
    "    plt.xticks(rotation=45, ha='right')\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats34:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.regplot(data=dataset_cleaned, x='right_acc_peak', y='amplitude_rknee_flex', ci=None, scatter_kws={\"s\": 50}, line_kws={\"color\": \"red\"},ax=axes[0])\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Force d'impact à droite (N)\")\n",
    "    axes[0].set_ylabel(\"Amplitude de flexion du genou à droite\")\n",
    "    sns.regplot(data=dataset_cleaned, x='left_acc_peak', y='amplitude_lknee_flex', ci=None, scatter_kws={\"s\": 50}, line_kws={\"color\": \"red\"}, ax=axes[1])\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Amplitude de flexion du genou à gauche\")\n",
    "    axes[1].set_xlabel(\"Force d'impact à gauche (N)\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats35:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.regplot(data=dataset_cleaned, x='stride_length', y='amplitude_rknee_flex', ci=None, scatter_kws={\"s\": 50}, line_kws={\"color\": \"red\"},ax=axes[0])\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Longueur de foulée (m)\")\n",
    "    axes[0].set_ylabel(\"Amplitude de flexion du genou à droite\")\n",
    "    sns.regplot(data=dataset_cleaned, x='stride_length', y='amplitude_lknee_flex', ci=None, scatter_kws={\"s\": 50}, line_kws={\"color\": \"red\"}, ax=axes[1])\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Amplitude de flexion du genou à gauche\")\n",
    "    axes[1].set_xlabel(\"Longueur de foulée (m)\")\n",
    "    plt.show()\n",
    "\n",
    "with graph_stats36:\n",
    "    fig, axes = plt.subplots(1, 2, figsize=(10, 5)) \n",
    "    sns.regplot(data=dataset_cleaned, x='stride_duration', y='amplitude_rknee_flex', ci=None, scatter_kws={\"s\": 50}, line_kws={\"color\": \"red\"},ax=axes[0])\n",
    "    axes[0].set_title(\" \")\n",
    "    axes[0].set_xlabel(\"Durée de foulée (s)\")\n",
    "    axes[0].set_ylabel(\"Amplitude de flexion du genou à droite\")\n",
    "    sns.regplot(data=dataset_cleaned, x='stride_duration', y='amplitude_lknee_flex', ci=None, scatter_kws={\"s\": 50}, line_kws={\"color\": \"red\"}, ax=axes[1])\n",
    "    axes[1].set_title(\" \")\n",
    "    axes[1].set_ylabel(\"Amplitude de flexion du genou à gauche\")\n",
    "    axes[1].set_xlabel(\"Durée de foulée (s)\")\n",
    "    plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 445,
   "id": "5a88df84-0a7a-4491-b979-741dbdc60ddf",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Datavisualisation correlation\n",
    "keep = [\"sex\", \"age\", \"size\", \"weight\", \"feeling\", \"pace_corrected\", \"stride_length\", \"stride_duration\", \n",
    "                                               \"symmetry_step\", \"symmetry_vlr\", \"symmetry_acc_peak\", \"symmetry_pelvis\", \"symmetry_knee\", \n",
    "                                               \"symmetry_hip\", \"diagnosis_body_region\", \"activity\"]\n",
    "dataset_ml = dataset_cleaned[keep].copy()\n",
    "\n",
    "dataset_ml[\"feeling\"] = dataset_ml[\"feeling\"].astype(int)\n",
    "dataset_ml_walk = dataset_ml[dataset_ml[\"activity\"].str.contains(\"walk\", case=False, na=False)].copy()\n",
    "dataset_ml_walk[\"feeling\"] = dataset_ml_walk[\"feeling\"].astype(int)\n",
    "dataset_ml_run = dataset_ml[dataset_ml[\"activity\"].str.contains(\"run\", case=False, na=False)].copy()\n",
    "dataset_ml_run[\"feeling\"] = dataset_ml_run[\"feeling\"].astype(int)\n",
    "\n",
    "\n",
    "\n",
    "df_correlation_matrix_temp_general=dataset_ml[[\"sex\", \"age\", \"size\", \"weight\", \"feeling\", \"pace_corrected\", \"stride_length\", \"stride_duration\", \n",
    "                                               \"symmetry_step\", \"symmetry_vlr\", \"symmetry_acc_peak\", \"symmetry_pelvis\", \"symmetry_knee\", \n",
    "                                               \"symmetry_hip\", \"diagnosis_body_region\"]]\n",
    "categorical_fields_general=df_correlation_matrix_temp_general.select_dtypes(include=[\"object\", \"category\"])\n",
    "df_correlation_matrix_general=pd.get_dummies(df_correlation_matrix_temp_general, columns=categorical_fields_general.columns.tolist())\n",
    "correlation_matrix_general=df_correlation_matrix_general.corr().round(2)\n",
    "\n",
    "with graph_correlation1:\n",
    "    plt.figure(figsize=(15, 12))\n",
    "    sns.heatmap(correlation_matrix_general, annot=False)\n",
    "    plt.xticks(rotation=90)\n",
    "    plt.yticks(rotation=0)\n",
    "    plt.tight_layout()\n",
    "    plt.show()\n",
    "\n",
    "remarkable_values_general = []\n",
    "for i in range(correlation_matrix_general.shape[0]):  \n",
    "    for j in range(i + 1, correlation_matrix_general.shape[1]):  \n",
    "        correlation_value = correlation_matrix_general.iloc[i, j]  \n",
    "        if abs(correlation_value) >= 0.5 and (\n",
    "            correlation_matrix_general.columns[i].startswith('diagnosis_body_region') or \n",
    "            correlation_matrix_general.columns[j].startswith('diagnosis_body_region')\n",
    "        ):\n",
    "            remarkable_values_general.append((correlation_value, correlation_matrix_general.columns[i], correlation_matrix_general.columns[j]))\n",
    "\n",
    "with correlation1:\n",
    "    for value in remarkable_values_general:  \n",
    "        display(f\"Correlation: {value[0]}, Variables: {value[1]} - {value[2]}\")\n",
    "\n",
    "df_correlation_matrix_temp_walk=dataset_ml_walk[[\"sex\", \"age\", \"size\", \"weight\", \"feeling\", \"pace_corrected\", \"stride_length\", \"stride_duration\", \n",
    "                                               \"symmetry_step\", \"symmetry_vlr\", \"symmetry_acc_peak\", \"symmetry_pelvis\", \"symmetry_knee\", \n",
    "                                               \"symmetry_hip\", \"diagnosis_body_region\"]]\n",
    "categorical_fields_walk=df_correlation_matrix_temp_walk.select_dtypes(include=[\"object\", \"category\"])\n",
    "df_correlation_matrix_walk=pd.get_dummies(df_correlation_matrix_temp_walk, columns=categorical_fields_walk.columns.tolist())\n",
    "correlation_matrix_walk=df_correlation_matrix_walk.corr().round(2)\n",
    "\n",
    "with graph_correlation2:\n",
    "    plt.figure(figsize=(15, 12))\n",
    "    sns.heatmap(correlation_matrix_walk, annot=False)\n",
    "    plt.xticks(rotation=90)\n",
    "    plt.yticks(rotation=0)\n",
    "    plt.tight_layout()\n",
    "    plt.show()\n",
    "\n",
    "remarkable_values_walk = []\n",
    "for i in range(correlation_matrix_walk.shape[0]):  \n",
    "    for j in range(i + 1, correlation_matrix_walk.shape[1]):  \n",
    "        correlation_value = correlation_matrix_walk.iloc[i, j]  \n",
    "        if abs(correlation_value) >= 0.5 and (\n",
    "            correlation_matrix_walk.columns[i].startswith('diagnosis_body_region') or \n",
    "            correlation_matrix_walk.columns[j].startswith('diagnosis_body_region')\n",
    "        ):\n",
    "            remarkable_values_walk.append((correlation_value, correlation_matrix_walk.columns[i], correlation_matrix_walk.columns[j]))\n",
    "\n",
    "with correlation2:\n",
    "    for value in remarkable_values_walk:  \n",
    "        display(f\"Correlation: {value[0]}, Variables: {value[1]} - {value[2]}\")\n",
    "\n",
    "\n",
    "df_correlation_matrix_temp_run=dataset_ml_run[[\"sex\", \"age\", \"size\", \"weight\", \"feeling\", \"pace_corrected\", \"stride_length\", \"stride_duration\", \n",
    "                                               \"symmetry_step\", \"symmetry_vlr\", \"symmetry_acc_peak\", \"symmetry_pelvis\", \"symmetry_knee\", \n",
    "                                               \"symmetry_hip\", \"diagnosis_body_region\"]]\n",
    "categorical_fields_run=df_correlation_matrix_temp_run.select_dtypes(include=[\"object\", \"category\"])\n",
    "df_correlation_matrix_run=pd.get_dummies(df_correlation_matrix_temp_run, columns=categorical_fields_run.columns.tolist())\n",
    "correlation_matrix_run=df_correlation_matrix_run.corr().round(2)\n",
    "\n",
    "with graph_correlation3:\n",
    "    plt.figure(figsize=(15, 12))\n",
    "    sns.heatmap(correlation_matrix_run, annot=False)\n",
    "    plt.xticks(rotation=90)\n",
    "    plt.yticks(rotation=0)\n",
    "    plt.tight_layout()\n",
    "    plt.show()\n",
    "\n",
    "remarkable_values_run = []\n",
    "for i in range(correlation_matrix_run.shape[0]):  \n",
    "    for j in range(i + 1, correlation_matrix_run.shape[1]):  \n",
    "        correlation_value = correlation_matrix_run.iloc[i, j]  \n",
    "        if abs(correlation_value) >= 0.5 and (\n",
    "            correlation_matrix_run.columns[i].startswith('diagnosis_body_region') or \n",
    "            correlation_matrix_run.columns[j].startswith('diagnosis_body_region')\n",
    "        ):\n",
    "            remarkable_values_run.append((correlation_value, correlation_matrix_run.columns[i], correlation_matrix_run.columns[j]))\n",
    "\n",
    "with correlation3:\n",
    "    for value in remarkable_values_run:  \n",
    "        display(f\"Correlation: {value[0]}, Variables: {value[1]} - {value[2]}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 446,
   "id": "600c64d8-cafb-4a97-8dcd-a0bd73b870b2",
   "metadata": {},
   "outputs": [],
   "source": [
    "# ML WALK\n",
    "# - Convert the 'sex' categorical column into binary columns (one-hot encoding)\n",
    "# - Ensure the new dummy variables are integers (not boolean)\n",
    "# - Encode the 'diagnosis_body_region' column into numeric labels using LabelEncoder\n",
    "# - Create a summary table showing the number of occurrences per diagnosis code and region\n",
    "# - Drop unused or irrelevant columns for modeling\n",
    "# - Keep only diagnosis codes with at least 3 samples (to avoid poorly represented classes)\n",
    "# - Separate features (X) and target (y)\n",
    "# - Display the diagnosis summary table (in notebook context, e.g., inside a panel or tab)\n",
    "# - Standardize the features (zero mean and unit variance)\n",
    "# - Split the data into training and testing sets (70/30), stratifying to preserve class distribution\n",
    "\n",
    "dataset_ml_walk=pd.get_dummies(dataset_ml_walk, columns=[\"sex\"], drop_first=True)\n",
    "dataset_ml_walk[\"sex_M\"] = dataset_ml_walk[\"sex_M\"].astype(int)\n",
    "\n",
    "le = LabelEncoder()\n",
    "dataset_ml_walk['diagnosis_code'] = le.fit_transform(dataset_ml_walk['diagnosis_body_region']) + 1\n",
    "\n",
    "diagnosis_body_region_summary_walk = (\n",
    "    dataset_ml_walk\n",
    "    .groupby(['diagnosis_code', 'diagnosis_body_region'], observed=True)\n",
    "    .size()  \n",
    "    .reset_index(name='count')\n",
    "    .sort_values(by='count', ascending=False)\n",
    ")\n",
    "\n",
    "dataset_ml_walk = dataset_ml_walk.drop(columns=[\"diagnosis_body_region\", \"activity\"])\n",
    "\n",
    "counts = dataset_ml_walk['diagnosis_code'].value_counts()\n",
    "valid_codes = counts[counts >= 3].index\n",
    "dataset_ml_walk_filtered = dataset_ml_walk[dataset_ml_walk['diagnosis_code'].isin(valid_codes)].copy()\n",
    "\n",
    "\n",
    "X_walk = dataset_ml_walk_filtered.drop(columns=[\"diagnosis_code\"])\n",
    "y_walk = dataset_ml_walk_filtered[\"diagnosis_code\"]\n",
    "\n",
    "with ml1:\n",
    "    display(diagnosis_body_region_summary_walk)\n",
    "\n",
    "scaler = StandardScaler()\n",
    "X_fit_walk =scaler.fit_transform(X_walk)\n",
    "\n",
    "X_train_walk, X_test_walk, y_train_walk, y_test_walk = train_test_split(\n",
    "    X_fit_walk, y_walk, test_size=0.20, random_state=42)\n",
    "\n",
    "# ML RUN\n",
    "# - Convert the 'sex' categorical column into binary columns (one-hot encoding)\n",
    "# - Ensure the new dummy variables are integers (not boolean)\n",
    "# - Encode the 'diagnosis_body_region' column into numeric labels using LabelEncoder\n",
    "# - Create a summary table showing the number of occurrences per diagnosis code and region\n",
    "# - Drop unused or irrelevant columns for modeling\n",
    "# - Keep only diagnosis codes with at least 3 samples (to avoid poorly represented classes)\n",
    "# - Separate features (X) and target (y)\n",
    "# - Display the diagnosis summary table (in notebook context, e.g., inside a panel or tab)\n",
    "# - Standardize the features (zero mean and unit variance)\n",
    "# - Split the data into training and testing sets (80/20), stratifying to preserve class distribution\n",
    "\n",
    "dataset_ml_run=pd.get_dummies(dataset_ml_run, columns=[\"sex\"], drop_first=True)\n",
    "dataset_ml_run[\"sex_M\"] = dataset_ml_run[\"sex_M\"].astype(int)\n",
    "\n",
    "le = LabelEncoder()\n",
    "dataset_ml_run['diagnosis_code'] = le.fit_transform(dataset_ml_run['diagnosis_body_region']) + 1\n",
    "\n",
    "diagnosis_body_region_summary_run = (\n",
    "    dataset_ml_run\n",
    "    .groupby(['diagnosis_code', 'diagnosis_body_region'], observed=True)\n",
    "    .size()  \n",
    "    .reset_index(name='count')\n",
    "    .sort_values(by='count', ascending=False)\n",
    ")\n",
    "\n",
    "dataset_ml_run = dataset_ml_run.drop(columns=[\"diagnosis_body_region\", \"activity\"])\n",
    "\n",
    "counts = dataset_ml_run['diagnosis_code'].value_counts()\n",
    "valid_codes = counts[counts >= 3].index\n",
    "dataset_ml_run_filtered = dataset_ml_run[dataset_ml_run['diagnosis_code'].isin(valid_codes)].copy()\n",
    "\n",
    "\n",
    "X_run = dataset_ml_run_filtered.drop(columns=[\"diagnosis_code\"])\n",
    "y_run = dataset_ml_run_filtered[\"diagnosis_code\"]\n",
    "\n",
    "\n",
    "with ml2:\n",
    "    display(diagnosis_body_region_summary_run)\n",
    "\n",
    "scaler = StandardScaler()\n",
    "X_fit_run =scaler.fit_transform(X_run)\n",
    "\n",
    "X_train_run, X_test_run, y_train_run, y_test_run = train_test_split(\n",
    "    X_fit_run, y_run, test_size=0.20, random_state=42)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 447,
   "id": "083d4885-6665-4bd1-949c-4fdf77bebff8",
   "metadata": {},
   "outputs": [],
   "source": [
    "# ML WALK\n",
    "# - Handle class imbalance by oversampling the minority classes in the training set\n",
    "# - Initialize a multinomial logistic regression model\n",
    "# - Train the model on the resampled training data\n",
    "# -  Make predictions on the original (non-resampled) test set\n",
    "# - Compute the confusion matrix using the true and predicted labels\n",
    "# - Create a display object for the confusion matrix\n",
    "\n",
    "sampler = RandomOverSampler(random_state=42)\n",
    "X_train_resampled_walk, y_train_resampled_walk = sampler.fit_resample(X_train_walk, y_train_walk)\n",
    "model = LogisticRegression(random_state=42, solver='newton-cg', multi_class='multinomial', class_weight='balanced')\n",
    "\n",
    "model.fit(X_train_resampled_walk, y_train_resampled_walk)\n",
    "y_pred_walk = model.predict(X_test_walk)\n",
    "\n",
    "cm_walk = confusion_matrix(y_test_walk, y_pred_walk, labels=model.classes_)\n",
    " \n",
    "disp_walk = ConfusionMatrixDisplay(confusion_matrix=cm_walk,\n",
    "                                   display_labels=model.classes_)\n",
    "\n",
    "coefficients = model.coef_[0]\n",
    "importance_df = pd.DataFrame({'Feature': X_walk.columns, 'Coefficient': coefficients[0] \n",
    "}).sort_values(by='Coefficient', ascending=False) \n",
    "\n",
    "with ml3:\n",
    "    display(\"Scores de performance :\")\n",
    "    display(\"Accuracy :\", round(accuracy_score(y_test_walk, y_pred_walk), 4))\n",
    "    display(\"Precision (moyenne):\", round(precision_score(y_test_walk, y_pred_walk, average='macro', zero_division=0), 4))\n",
    "    display(\"Recall (moyenne):\", round(recall_score(y_test_walk, y_pred_walk, average='macro', zero_division=0), 4))\n",
    "    display(\"F1-score (moyenne):\", round(f1_score(y_test_walk, y_pred_walk, average='macro'), 4)) \n",
    "    classes = model.classes_\n",
    "    y_test_walk_bin = label_binarize(y_test_walk, classes=classes)\n",
    "    y_walk_score = model.predict_proba(X_test_walk)\n",
    "    roc_auc_walk_macro = roc_auc_score(y_test_walk_bin, y_walk_score, average=\"macro\", multi_class=\"ovr\")\n",
    "    roc_auc_walk_micro = roc_auc_score(y_test_walk_bin, y_walk_score, average=\"micro\", multi_class=\"ovr\")\n",
    "    display(\"ROC AUC (macro):\", round(roc_auc_walk_macro, 4))\n",
    "    display(\"ROC AUC (micro):\", round(roc_auc_walk_micro, 4))\n",
    "    print(classification_report(y_test_walk, y_pred_walk, labels=model.classes_, target_names=[str(c) for c in classes]))\n",
    "    print(importance_df)\n",
    "    disp_walk.plot()\n",
    "    plt.show()\n",
    "\n",
    "#ML RUN\n",
    "# - Handle class imbalance by oversampling the minority classes in the training set\n",
    "# - Initialize a multinomial logistic regression model\n",
    "# - Train the model on the resampled training data\n",
    "# -  Make predictions on the original (non-resampled) test set\n",
    "# - Compute the confusion matrix using the true and predicted labels\n",
    "# - Create a display object for the confusion matrix\n",
    "sampler = RandomOverSampler(random_state=42)\n",
    "X_train_resampled_run, y_train_resampled_run = sampler.fit_resample(X_train_run, y_train_run)\n",
    "model = LogisticRegression(random_state=42, solver='newton-cg', multi_class='multinomial', class_weight='balanced')\n",
    "\n",
    "model.fit(X_train_resampled_run, y_train_resampled_run)\n",
    "y_pred_run = model.predict(X_test_run)\n",
    "\n",
    "cm_run = confusion_matrix(y_test_run, y_pred_run, labels=model.classes_)\n",
    " \n",
    "disp_run = ConfusionMatrixDisplay(confusion_matrix=cm_run,\n",
    "                                   display_labels=model.classes_)\n",
    "\n",
    "coefficients = model.coef_[0]\n",
    "importance_df = pd.DataFrame({'Feature': X_run.columns, 'Coefficient': coefficients[0] \n",
    "}).sort_values(by='Coefficient', ascending=False) \n",
    "\n",
    "with ml4:\n",
    "    display(\"Scores de performance :\")\n",
    "    display(\"Accuracy :\", round(accuracy_score(y_test_run, y_pred_run), 4))\n",
    "    display(\"Precision (moyenne):\", round(precision_score(y_test_run, y_pred_run, average='macro', zero_division=0), 4))\n",
    "    display(\"Recall (moyenne):\", round(recall_score(y_test_run, y_pred_run, average='macro', zero_division=0), 4))\n",
    "    display(\"F1-score (moyenne):\", round(f1_score(y_test_run, y_pred_run, average='macro'), 4)) \n",
    "    classes = model.classes_\n",
    "    y_test_run_bin = label_binarize(y_test_run, classes=classes)\n",
    "    y_run_score = model.predict_proba(X_test_run)\n",
    "    roc_auc_run_macro = roc_auc_score(y_test_run_bin, y_run_score, average=\"macro\", multi_class=\"ovr\")\n",
    "    roc_auc_run_micro = roc_auc_score(y_test_run_bin, y_run_score, average=\"micro\", multi_class=\"ovr\")\n",
    "    display(\"ROC AUC (macro):\", round(roc_auc_run_macro, 4))\n",
    "    display(\"ROC AUC (micro):\", round(roc_auc_run_micro, 4))\n",
    "    print(classification_report(y_test_run, y_pred_run, labels=model.classes_, target_names=[str(c) for c in classes]))\n",
    "    print(importance_df)\n",
    "    disp_run.plot()\n",
    "    plt.show()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 448,
   "id": "b2327f71-d8b8-4985-8ef4-63694af13a70",
   "metadata": {},
   "outputs": [],
   "source": [
    "#ML WALK\n",
    "#  Train a Random Forest classifier on oversampled data and evaluate its performance using multiple metrics and a confusion matrix plot\n",
    "sampler = RandomOverSampler(random_state=42)\n",
    "X_train_resampled_walk, y_train_resampled_walk = sampler.fit_resample(X_train_walk, y_train_walk)\n",
    "\n",
    "model = RandomForestClassifier(n_estimators=10, class_weight='balanced', criterion='gini', random_state=42)\n",
    "\n",
    "model.fit(X_train_resampled_walk, y_train_resampled_walk)\n",
    "y_pred_walk = model.predict(X_test_walk)\n",
    "\n",
    "cm_walk = confusion_matrix(y_test_walk, y_pred_walk, labels=model.classes_)\n",
    "disp_walk = ConfusionMatrixDisplay(confusion_matrix=cm_walk, display_labels=model.classes_)\n",
    "\n",
    "with ml5:\n",
    "    display(\"Scores de performance :\")\n",
    "    display(\"Accuracy :\", round(accuracy_score(y_test_walk, y_pred_walk), 4))\n",
    "    display(\"Precision (moyenne):\", round(precision_score(y_test_walk, y_pred_walk, average='macro', zero_division=0), 4))\n",
    "    display(\"Recall (moyenne):\", round(recall_score(y_test_walk, y_pred_walk, average='macro', zero_division=0), 4))\n",
    "    display(\"F1-score (moyenne):\", round(f1_score(y_test_walk, y_pred_walk, average='macro'), 4)) \n",
    "    classes = model.classes_\n",
    "    y_test_walk_bin = label_binarize(y_test_walk, classes=classes)\n",
    "    y_walk_score = model.predict_proba(X_test_walk)\n",
    "    roc_auc_walk_macro = roc_auc_score(y_test_walk_bin, y_walk_score, average=\"macro\", multi_class=\"ovr\")\n",
    "    roc_auc_walk_micro = roc_auc_score(y_test_walk_bin, y_walk_score, average=\"micro\", multi_class=\"ovr\")\n",
    "    display(\"ROC AUC (macro):\", round(roc_auc_walk_macro, 4))\n",
    "    display(\"ROC AUC (micro):\", round(roc_auc_walk_micro, 4))\n",
    "    print(classification_report(y_test_walk, y_pred_walk, labels=model.classes_, target_names=[str(c) for c in classes]))\n",
    "    disp_walk.plot()\n",
    "    plt.show()\n",
    "\n",
    "feature_importances = model.feature_importances_\n",
    "importance_df = pd.DataFrame({\n",
    "    'Feature': X_walk.columns,\n",
    "    'Importance': feature_importances\n",
    "}).sort_values(by='Importance', ascending=False)[:20]\n",
    "\n",
    "with ml6:\n",
    "    plt.figure(figsize=(10, 6))\n",
    "    sns.barplot(x='Importance', y='Feature', data=importance_df)\n",
    "    plt.title('Feature Importances')\n",
    "    plt.show()\n",
    "    print(importance_df)\n",
    "\n",
    "\n",
    "#ML RUN\n",
    "#  Train a Random Forest classifier on oversampled data and evaluate its performance using multiple metrics and a confusion matrix plot\n",
    "sampler = RandomOverSampler(random_state=42)\n",
    "X_train_resampled_run, y_train_resampled_run = sampler.fit_resample(X_train_run, y_train_run)\n",
    "\n",
    "model = RandomForestClassifier(n_estimators=10, class_weight='balanced', criterion='gini', random_state=42)\n",
    "\n",
    "model.fit(X_train_resampled_run, y_train_resampled_run)\n",
    "y_pred_run = model.predict(X_test_run)\n",
    "\n",
    "cm_run = confusion_matrix(y_test_run, y_pred_run, labels=model.classes_)\n",
    "disp_run = ConfusionMatrixDisplay(confusion_matrix=cm_run, display_labels=model.classes_)\n",
    "\n",
    "with ml7:\n",
    "    display(\"Scores de performance :\")\n",
    "    display(\"Accuracy :\", round(accuracy_score(y_test_run, y_pred_run), 4))\n",
    "    display(\"Precision (moyenne):\", round(precision_score(y_test_run, y_pred_run, average='macro', zero_division=0), 4))\n",
    "    display(\"Recall (moyenne):\", round(recall_score(y_test_run, y_pred_run, average='macro', zero_division=0), 4))\n",
    "    display(\"F1-score (moyenne):\", round(f1_score(y_test_run, y_pred_run, average='macro'), 4)) \n",
    "    classes = model.classes_\n",
    "    y_test_run_bin = label_binarize(y_test_run, classes=classes)\n",
    "    y_run_score = model.predict_proba(X_test_run)\n",
    "    roc_auc_run_macro = roc_auc_score(y_test_run_bin, y_run_score, average=\"macro\", multi_class=\"ovr\")\n",
    "    roc_auc_run_micro = roc_auc_score(y_test_run_bin, y_run_score, average=\"micro\", multi_class=\"ovr\")\n",
    "    display(\"ROC AUC (macro):\", round(roc_auc_run_macro, 4))\n",
    "    display(\"ROC AUC (micro):\", round(roc_auc_run_micro, 4))\n",
    "    print(classification_report(y_test_run, y_pred_run, labels=model.classes_, target_names=[str(c) for c in classes]))\n",
    "    disp_run.plot()\n",
    "    plt.show()\n",
    "\n",
    "feature_importances = model.feature_importances_\n",
    "importance_df = pd.DataFrame({\n",
    "    'Feature': X_run.columns,\n",
    "    'Importance': feature_importances\n",
    "}).sort_values(by='Importance', ascending=False)[:20]\n",
    "\n",
    "with ml8:\n",
    "    plt.figure(figsize=(10, 6))\n",
    "    sns.barplot(x='Importance', y='Feature', data=importance_df)\n",
    "    plt.title('Feature Importances')\n",
    "    plt.show()\n",
    "    print(importance_df)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 449,
   "id": "972523d5-0e46-4ed8-8e20-a3980ccc874d",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "c5b6642b235e4cd6b49fb557e478b5a7",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "HBox(children=(Button(description='Exporter le jeu de données non nettoyé', layout=Layout(width='300px'), styl…"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "8f4d6e76379d4bbe8aacd786620e01cf",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Tab(children=(VBox(children=(Accordion(children=(VBox(children=(HTML(value='<p>En cas de comptes multiples pou…"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Dashboard creation (Voilà)\n",
    "\n",
    "#Export Excel\n",
    "export_button1.layout.width = '300px'\n",
    "export_button2.layout.width = '300px'\n",
    "button_box = widgets.HBox([export_button1, export_button2])\n",
    "display(button_box)\n",
    "\n",
    "# Tab trainer\n",
    "\n",
    "trainer_count_label = widgets.Label(f\"Nombre de praticiens : {len(df_trainer_grouped)}\")\n",
    "html_content_trainer1= widgets.HTML(value=\"<p>En cas de comptes multiples pour un praticien, seul un praticien est compté (rassemblement par nom, prénom et adresse mail)</p>\")\n",
    "\n",
    "accordion_content_trainer1= widgets.VBox([html_content_trainer1, trainer_count_label, table_trainer1])\n",
    "accordion_trainer1 = widgets.Accordion(children=[accordion_content_trainer1])\n",
    "accordion_trainer1.set_title(0, \"Résumé\")\n",
    "\n",
    "accordion_content_trainer2= widgets.VBox([graph_trainer1])\n",
    "accordion_trainer2 = widgets.Accordion(children=[accordion_content_trainer2])\n",
    "accordion_trainer2.set_title(0, \"Evolution du nombre de praticiens par mois dans la plateforme\")\n",
    "\n",
    "tab0_content = widgets.VBox([accordion_trainer1, accordion_trainer2])\n",
    "\n",
    "# Tab runner\n",
    "\n",
    "runner_count_label = widgets.Label(f\"Nombre de patients : {len(df_unique_runners)}\")\n",
    "\n",
    "accordion_content_runner1 = widgets.VBox([runner_count_label, table_runner1])\n",
    "accordion_runner1 = widgets.Accordion (children=[accordion_content_runner1])\n",
    "accordion_runner1.set_title(0, \"Résumé\")\n",
    "\n",
    "accordion_content_runner2 = widgets.VBox([table_runner2])\n",
    "accordion_runner2 = widgets.Accordion (children=[accordion_content_runner2])\n",
    "accordion_runner2.set_title(0, \"Nombre de patients par praticien\")\n",
    "\n",
    "accordion_content_runner3 = widgets.VBox([graph_runner1])\n",
    "accordion_runner3 = widgets.Accordion (children=[accordion_content_runner3])\n",
    "accordion_runner3.set_title(0, \"Répartition des sexes\")\n",
    "\n",
    "accordion_content_runner4 = widgets.VBox([graph_runner2])\n",
    "accordion_runner4 = widgets.Accordion (children=[accordion_content_runner4])\n",
    "accordion_runner4.set_title(0, \"Répartition des âges\")\n",
    "\n",
    "accordion_content_runner5 = widgets.VBox([graph_runner3])\n",
    "accordion_runner5 = widgets.Accordion (children=[accordion_content_runner5])\n",
    "accordion_runner5.set_title(0, \"Répartition des tailles\")\n",
    "\n",
    "accordion_content_runner6 = widgets.VBox([graph_runner4])\n",
    "accordion_runner6 = widgets.Accordion (children=[accordion_content_runner6])\n",
    "accordion_runner6.set_title(0, \"Répartition des poids\")\n",
    "\n",
    "tab1_content = widgets.VBox([accordion_runner1, accordion_runner2, accordion_runner3, accordion_runner4, accordion_runner5, accordion_runner6])\n",
    "\n",
    "\n",
    "# Tab diagnosis\n",
    "\n",
    "html_content_diagnosis1 = widgets.HTML(value=\"<h3>Fréquence des régions du corps traitées</h3>\")\n",
    "html_content_diagnosis2 = widgets.HTML(value=\"<h3>Fréquence des régions du corps traitées en fonction des sexes</h3>\")\n",
    "\n",
    "\n",
    "accordion_content_diagnosis1 = widgets.VBox([table_diagnosis1])\n",
    "accordion_diagnosis1 = widgets.Accordion (children=[accordion_content_diagnosis1])\n",
    "accordion_diagnosis1.set_title(0, \"Pathologie/région du corps\")\n",
    "\n",
    "accordion_content_diagnosis2 = widgets.VBox([html_content_diagnosis1, graph_diagnosis1])\n",
    "accordion_diagnosis2 = widgets.Accordion (children=[accordion_content_diagnosis2])\n",
    "accordion_diagnosis2.set_title(0, \"Région du corps\")\n",
    "\n",
    "accordion_content_diagnosis3 = widgets.VBox([html_content_diagnosis2, graph_diagnosis2])\n",
    "accordion_diagnosis3 = widgets.Accordion (children=[accordion_content_diagnosis3])\n",
    "accordion_diagnosis3.set_title(0, \"Fréquence des patholoogies\")\n",
    "                                       \n",
    "tab2_content = widgets.VBox([accordion_diagnosis1, accordion_diagnosis2, accordion_diagnosis3])\n",
    "\n",
    "# Tab sessions\n",
    "session_count_label = widgets.Label(f\"Nombre de premières sessions : {len(dataset_cleaned)}\")\n",
    "html_content_session1 = widgets.HTML(value=\"<p>1 : je ne suis pas en forme ; 10 : je suis très en forme</p>\")\n",
    "html_content_session2 = widgets.HTML(value=\"<p>Une session doit au moins durer 30 secondes pour avoir des données fiables.</p><p>La variable représentée ici correspond à la durée de l'activité corrigée (NbPas*DureeFoulee/2).</p>\")\n",
    "\n",
    "accordion_content_session0 = widgets.VBox([session_count_label])\n",
    "accordion_session0 = widgets.Accordion (children=[accordion_content_session0])\n",
    "accordion_session0.set_title(0, \"Résumé\")\n",
    "\n",
    "accordion_content_session1 = widgets.VBox([graph_session1])\n",
    "accordion_session1 = widgets.Accordion (children=[accordion_content_session1])\n",
    "accordion_session1.set_title(0, \"Répartition des types d'activités (marche ou course à pied)\")\n",
    "\n",
    "accordion_content_session2 = widgets.VBox([html_content_session1, graph_session2])\n",
    "accordion_session2 = widgets.Accordion (children=[accordion_content_session2])\n",
    "accordion_session2.set_title(0, \"Distribution des ressentis\")\n",
    "\n",
    "accordion_content_session3 = widgets.VBox([html_content_session2, graph_session3])\n",
    "accordion_session3 = widgets.Accordion (children=[accordion_content_session3])\n",
    "accordion_session3.set_title(0, \"Durée des sessions par type d'activité\")\n",
    "\n",
    "\n",
    "tab3_content = widgets.VBox([accordion_session0, accordion_session1, accordion_session2, accordion_session3])\n",
    "\n",
    "# Tab kinetics\n",
    "html_content_kinetics1 = widgets.HTML(value=\"<p>La variable distance est la variable corrigée NbPas*StrideLength/2.</p>\")\n",
    "html_content_kinetics2 = widgets.HTML(value=\"<p>La cadence théorique est calculée avec la formule 120/DureeFoulee.</p><p> Dans la littérature, la cadence en marche est comprise entre 90 et 130 pas/min et entre 150 et 190 pas/min pour la course à pied. </p>\")\n",
    "html_content_kinetics3 = widgets.HTML(value=\"<p>La vitesse théorique est calculée avec la cadence théorique.</p>\")\n",
    "html_content_kinetics4 = widgets.HTML(value=\"<h3>Distribution</h3>\")\n",
    "html_content_kinetics5 = widgets.HTML(value=\"<h3>Symétrie des impacts</h3>\")\n",
    "html_content_kinetics6 = widgets.HTML(value=\"<h3>Répartition des symétries pour les forces d'impacts</h3>\")\n",
    "html_content_kinetics7 = widgets.HTML(value=\"<h3>Distribution</h3><p> Dans la littérature scientifique, on retrouve des amortis entre 60 et 120 BW/S.</p>\")\n",
    "html_content_kinetics8 = widgets.HTML(value=\"<h3>Symétrie des amortis</h3>\")\n",
    "html_content_kinetics9 = widgets.HTML(value=\"<h3>Répartition des symétries pour les amortis</h3>\") \n",
    "\n",
    "accordion_content_kinetics1 = widgets.VBox([html_content_kinetics1, graph_kinetics1])\n",
    "accordion_kinetics1 = widgets.Accordion (children=[accordion_content_kinetics1])\n",
    "accordion_kinetics1.set_title(0, \"Nombre de pas et distance parcourue\")\n",
    "\n",
    "accordion_content_kinetics2 = widgets.VBox([html_content_kinetics2, graph_kinetics2])\n",
    "accordion_kinetics2 = widgets.Accordion (children=[accordion_content_kinetics2])\n",
    "accordion_kinetics2.set_title(0, \"Cadence\")\n",
    "\n",
    "accordion_content_kinetics3 = widgets.VBox([html_content_kinetics3, graph_kinetics3])\n",
    "accordion_kinetics3 = widgets.Accordion (children=[accordion_content_kinetics3])\n",
    "accordion_kinetics3.set_title(0, \"Vitesse\")\n",
    "\n",
    "accordion_content_kinetics4 = widgets.VBox([html_content_kinetics4, graph_kinetics4, html_content_kinetics5, graph_kinetics5, html_content_kinetics6,\n",
    "                                           graph_kinetics6])\n",
    "accordion_kinetics4 = widgets.Accordion (children=[accordion_content_kinetics4])\n",
    "accordion_kinetics4.set_title(0, \"Forces d'impacts\")\n",
    "\n",
    "accordion_content_kinetics5 = widgets.VBox([html_content_kinetics7, graph_kinetics7, html_content_kinetics8, graph_kinetics8, \n",
    "                             html_content_kinetics9, graph_kinetics9])\n",
    "accordion_kinetics5 = widgets.Accordion (children=[accordion_content_kinetics5])\n",
    "accordion_kinetics5.set_title(0, \"Amortis\")\n",
    "\n",
    "tab4_content = widgets.VBox([accordion_kinetics1, accordion_kinetics2, accordion_kinetics3, accordion_kinetics4, accordion_kinetics5])\n",
    "\n",
    "# Tab spatio-temporal\n",
    "html_content_spatio1 = widgets.HTML(value=\"<p>Dans la littérature scientifique, on retrouve des longueurs de foulée entre 1 et 1,2 mètres pour la marche, et 1,5 à 2,5 mètres pour la course à pied.\")\n",
    "html_content_spatio2 = widgets.HTML(value=\"<p>Dans la littérature scientifique, on retrouve des durées de foulées autour de 1 à 1,2 secondes pour la marche et autour de 0,7 secondes pour la course à pied.\")\n",
    "html_content_spatio3 = widgets.HTML(value=\"<h3>Symétrie de la durée et de la longueur des pas</h3><p>Le frontend contient une erreur pour la symétrie de la durée des pas, qui a été corrigé dans cette analyse</p>\")\n",
    "html_content_spatio4 = widgets.HTML(value=\"<h3>Symétrie globale des pas</h3>\")\n",
    "html_content_spatio5 = widgets.HTML(value=\"<p>Répartition des symétries de pas</p>\")\n",
    "\n",
    "\n",
    "accordion_content_spatio1 = widgets.VBox([html_content_spatio1, graph_spatio1])\n",
    "accordion_spatio1 = widgets.Accordion (children=[accordion_content_spatio1])\n",
    "accordion_spatio1.set_title(0, \"Longueur de foulée et de pas\")\n",
    "\n",
    "accordion_content_spatio2 = widgets.VBox([html_content_spatio2, graph_spatio2])\n",
    "accordion_spatio2 = widgets.Accordion (children=[accordion_content_spatio2])\n",
    "accordion_spatio2.set_title(0, \"Durée de foulée et de pas\")\n",
    "\n",
    "accordion_content_spatio3 = widgets.VBox([html_content_spatio3, graph_spatio3, html_content_spatio4, graph_spatio4, html_content_spatio5, graph_spatio5])\n",
    "accordion_spatio3 = widgets.Accordion (children=[accordion_content_spatio3])\n",
    "accordion_spatio3.set_title(0, \"Symétrie des pas\")\n",
    "\n",
    "\n",
    "tab5_content = widgets.VBox([accordion_spatio1, accordion_spatio2, accordion_spatio3])\n",
    "\n",
    "# Tab pelvis\n",
    "html_content_pelvis1 = widgets.HTML(value=\"<h3>Distribution</h3>\")\n",
    "html_content_pelvis2 = widgets.HTML(value=\"<h3>Répartition</h3>\")\n",
    "html_content_pelvis3 = widgets.HTML(value=\"<h3>Symétrie du bassin en phase d'appui</h3>\")\n",
    "html_content_pelvis4 = widgets.HTML(value=\"<h3>Répartition</h3>\")\n",
    "html_content_pelvis5 = widgets.HTML(value=\"<h3>Symétrie du bassin en phase oscillante</h3>\")\n",
    "html_content_pelvis6 = widgets.HTML(value=\"<h3>Répartition</h3>\")\n",
    "html_content_pelvis7 = widgets.HTML(value=\"<h3>Inclinaison minium</h3>\")\n",
    "html_content_pelvis8 = widgets.HTML(value=\"<h3>Inclinaison maximum</h3>\")\n",
    "html_content_pelvis9 = widgets.HTML(value=\"<h3>Version minimum</h3>\")\n",
    "html_content_pelvis10 = widgets.HTML(value=\"<h3>Version maximum</h3>\")\n",
    "\n",
    "accordion_content_pelvis1 = widgets.VBox([html_content_pelvis1, graph_pelvis1, html_content_pelvis2, graph_pelvis2])\n",
    "accordion_pelvis1 = widgets.Accordion (children=[accordion_content_pelvis1])\n",
    "accordion_pelvis1.set_title(0, \"Symétrie du bassin (global)\")\n",
    "\n",
    "accordion_content_pelvis2 = widgets.VBox([html_content_pelvis3, graph_pelvis3, html_content_pelvis4, graph_pelvis4])\n",
    "accordion_pelvis2 = widgets.Accordion (children=[accordion_content_pelvis2])\n",
    "accordion_pelvis2.set_title(0, \"Symétrie du bassin (phase d'appui)\")\n",
    "\n",
    "accordion_content_pelvis3 = widgets.VBox([html_content_pelvis5, graph_pelvis5, html_content_pelvis6, graph_pelvis6])\n",
    "accordion_pelvis3 = widgets.Accordion (children=[accordion_content_pelvis3])\n",
    "accordion_pelvis3.set_title(0, \"Symétrie du bassin (phase oscillante)\")\n",
    "\n",
    "accordion_content_pelvis4 = widgets.VBox([html_content_pelvis7, graph_pelvis7, html_content_pelvis8, graph_pelvis8])\n",
    "accordion_pelvis4 = widgets.Accordion (children=[accordion_content_pelvis4])\n",
    "accordion_pelvis4.set_title(0, \"Inclinaison du bassin\")\n",
    "\n",
    "accordion_content_pelvis5 = widgets.VBox([html_content_pelvis9, graph_pelvis9, html_content_pelvis10, graph_pelvis10])\n",
    "accordion_pelvis5 = widgets.Accordion (children=[accordion_content_pelvis5])\n",
    "accordion_pelvis5.set_title(0, \"Version du bassin\")\n",
    "\n",
    "\n",
    "tab6_content = widgets.VBox([accordion_pelvis1, accordion_pelvis2, accordion_pelvis3, accordion_pelvis4, accordion_pelvis5])\n",
    "\n",
    "\n",
    "# Tab hips\n",
    "\n",
    "html_content_hips1 = widgets.HTML(value=\"<h3>Distribution</h3>\")\n",
    "html_content_hips2 = widgets.HTML(value=\"<h3>Répartition des symétries des hanches</h3>\")\n",
    "html_content_hips3 = widgets.HTML(value=\"<h3>Adduction/Abduction globale</h3>\")\n",
    "html_content_hips4 = widgets.HTML(value=\"<h3>Flexion globale</h3>\")\n",
    "html_content_hips5 = widgets.HTML(value=\"<h3>Rotation globale</h3>\")\n",
    "html_content_hips6 = widgets.HTML(value=\"<h3>Symétrie des hanches en phase d'appui </h3>\")\n",
    "html_content_hips7 = widgets.HTML(value=\"<h3>Répartition des symétries des hanches</h3>\")\n",
    "html_content_hips8 = widgets.HTML(value=\"<h3>Adduction/Abduction en phase d'appui</h3>\")\n",
    "html_content_hips9 = widgets.HTML(value=\"<h3>Flexion en phase d'appui</h3>\")\n",
    "html_content_hips10 = widgets.HTML(value=\"<h3>Rotation en phase d'appui</p>\")\n",
    "html_content_hips11 = widgets.HTML(value=\"<h3>Symétrie des hanches en phase oscillante </h3>\")\n",
    "html_content_hips12= widgets.HTML(value=\"<p>Répartition des symétries des hanches</p>\")\n",
    "html_content_hips13 = widgets.HTML(value=\"<p>Adduction/Abduction en phase oscillante</p>\")\n",
    "html_content_hips14 = widgets.HTML(value=\"<p>Flexion en phase oscillante</p>\")\n",
    "html_content_hips15 = widgets.HTML(value=\"<p>Rotation en phase oscillante</p>\")\n",
    "\n",
    "accordion_content_hips1 = widgets.VBox([html_content_hips1, graph_hips1, html_content_hips2,graph_hips2, html_content_hips3, graph_hips3, \n",
    "                             graph_hips4, html_content_hips4, graph_hips5, graph_hips6, html_content_hips5, graph_hips7, graph_hips8])\n",
    "accordion_hips1 = widgets.Accordion (children=[accordion_content_hips1])\n",
    "accordion_hips1.set_title(0, \"Symétrie des hanches (global)\")\n",
    "\n",
    "accordion_content_hips2 = widgets.VBox([html_content_hips6, graph_hips9, html_content_hips7,graph_hips10, html_content_hips8, graph_hips11, \n",
    "                             graph_hips12, html_content_hips9, graph_hips13, graph_hips14, html_content_hips10, graph_hips15, graph_hips16])\n",
    "accordion_hips2 = widgets.Accordion (children=[accordion_content_hips2])\n",
    "accordion_hips2.set_title(0, \"Symétrie des hanches(phase d'appui)\")\n",
    "\n",
    "accordion_content_hips3 = widgets.VBox([html_content_hips11, graph_hips17, html_content_hips12, graph_hips18, html_content_hips13, graph_hips19, \n",
    "                             graph_hips20, html_content_hips14, graph_hips21, graph_hips22, html_content_hips15, graph_hips23, graph_hips24])\n",
    "accordion_hips3 = widgets.Accordion (children=[accordion_content_hips3])\n",
    "accordion_hips3.set_title(0, \"Symétrie des hanches (phase oscillante)\")\n",
    "\n",
    "tab7_content = widgets.VBox([accordion_hips1, accordion_hips2, accordion_hips3])\n",
    "\n",
    "# Tab knee\n",
    "html_content_knee1 = widgets.HTML(value=\"<h3>Distribution</h3>\")\n",
    "html_content_knee2 = widgets.HTML(value=\"<h3>Répartition des symétries des genoux</h3>\")\n",
    "html_content_knee3 = widgets.HTML(value=\"<h3>Valgus global</h3>\")\n",
    "html_content_knee4 = widgets.HTML(value=\"<h3>Flexion globale</h3>\")\n",
    "html_content_knee5 = widgets.HTML(value=\"<h3>Rotation globale</h3>\")\n",
    "html_content_knee6 = widgets.HTML(value=\"<h3>Symétrie des genoux en phase d'appui</h3>\")\n",
    "html_content_knee7 = widgets.HTML(value=\"<h3>Répartition des symétries des genoux</h3>\")\n",
    "html_content_knee8 = widgets.HTML(value=\"<h3>Valgus en phase d'appui</h3>\")\n",
    "html_content_knee9 = widgets.HTML(value=\"<h3>Flexion en phase d'appui</h3>\")\n",
    "html_content_knee10 = widgets.HTML(value=\"<h3>Rotation en phase d'appui</h3>\")\n",
    "html_content_knee11 = widgets.HTML(value=\"<h3>Symétrie des genoux en phase oscillante</h3>\")\n",
    "html_content_knee12 = widgets.HTML(value=\"<h3>Répartition des symétries des genoux</h3>\")\n",
    "html_content_knee13 = widgets.HTML(value=\"<h3>Valgus en phase oscillante</h3>\")\n",
    "html_content_knee14 = widgets.HTML(value=\"<h3>Flexion en phase oscillante</h3>\")\n",
    "html_content_knee15 = widgets.HTML(value=\"<h3>Rotation en phase oscillante</h3>\")\n",
    "\n",
    "\n",
    "\n",
    "accordion_content_knee1 = widgets.VBox([html_content_knee1, graph_knee1, html_content_knee2, graph_knee2, html_content_knee3, graph_knee3, graph_knee4, \n",
    "                            html_content_knee4, graph_knee5, graph_knee6, html_content_knee5, graph_knee7, graph_knee8])\n",
    "accordion_knee1 = widgets.Accordion (children=[accordion_content_knee1])\n",
    "accordion_knee1.set_title(0, \"Symétrie des genoux (global)\")\n",
    "\n",
    "accordion_content_knee2 = widgets.VBox([html_content_knee6, graph_knee9, html_content_knee7, graph_knee10, html_content_knee8, graph_knee11, graph_knee12, \n",
    "                            html_content_knee9, graph_knee13, graph_knee14, html_content_knee10, graph_knee15, graph_knee16])\n",
    "accordion_knee2 = widgets.Accordion (children=[accordion_content_knee2])\n",
    "accordion_knee2.set_title(0, \"Symétrie des genoux (phase d'appui)\")\n",
    "\n",
    "accordion_content_knee3 = widgets.VBox([html_content_knee11, graph_knee17, html_content_knee12, graph_knee18, html_content_knee13, graph_knee19, graph_knee20, \n",
    "                            html_content_knee14, graph_knee21, graph_knee22, html_content_knee15, graph_knee23, graph_knee24])\n",
    "accordion_knee3 = widgets.Accordion (children=[accordion_content_knee3])\n",
    "accordion_knee3.set_title(0, \"Symétrie des genoux (phase oscillante)\")\n",
    "\n",
    "tab8_content = widgets.VBox([accordion_knee1, accordion_knee2, accordion_knee3])\n",
    "\n",
    "# Tab statistics\n",
    "\n",
    "html_content_stats1 = widgets.HTML(value=\"<p>Test d'indépendance (Khi²) : une p-value <0.001 signifie que les variables sont associées de manière significative. Un coefficient de Cramer proche de 1 indique une association forte.</p>\")\n",
    "\n",
    "accordion_content_stats1= widgets.VBox([table_stats1, html_content_stats1, content_stats1 ])\n",
    "accordion_stats1 = widgets.Accordion(children=[accordion_content_stats1])\n",
    "accordion_stats1.set_title(0, \"Lien sexe-pathologie\")\n",
    "\n",
    "accordion_content_stats2 = widgets.VBox([graph_stats1, graph_stats2])\n",
    "accordion_stats2 = widgets.Accordion(children=[accordion_content_stats2])\n",
    "accordion_stats2.set_title(0, \"Lien âge-pathologie\")\n",
    "\n",
    "accordion_content_stats3 = widgets.VBox([graph_stats3, graph_stats4])\n",
    "accordion_stats3 = widgets.Accordion(children=[accordion_content_stats3])\n",
    "accordion_stats3.set_title(0, \"Lien taille-pathologie\")\n",
    "\n",
    "accordion_content_stats4 = widgets.VBox([graph_stats5, graph_stats6])\n",
    "accordion_stats4 = widgets.Accordion(children=[accordion_content_stats4])\n",
    "accordion_stats4.set_title(0, \"Lien poids-pathologie\")\n",
    "\n",
    "accordion_content_stats5 = widgets.VBox([graph_stats7, graph_stats8])\n",
    "accordion_stats5 = widgets.Accordion(children=[accordion_content_stats5])\n",
    "accordion_stats5.set_title(0, \"Lien ressenti-pathologie\")\n",
    "\n",
    "accordion_content_stats6 = widgets.VBox([graph_stats9, graph_stats10])\n",
    "accordion_stats6 = widgets.Accordion(children=[accordion_content_stats6])\n",
    "accordion_stats6.set_title(0, \"Lien cadence-pathologie\")\n",
    "\n",
    "accordion_content_stats7 = widgets.VBox([graph_stats11, graph_stats12])\n",
    "accordion_stats7 = widgets.Accordion(children=[accordion_content_stats7])\n",
    "accordion_stats7.set_title(0, \"Lien durée foulée-pathologie\")\n",
    "\n",
    "accordion_content_stats8 = widgets.VBox([graph_stats13, graph_stats14])\n",
    "accordion_stats8 = widgets.Accordion(children=[accordion_content_stats8])\n",
    "accordion_stats8.set_title(0, \"Lien longueur foulée-pathologie\")\n",
    "\n",
    "accordion_content_stats9 = widgets.VBox([graph_stats15, graph_stats16])\n",
    "accordion_stats9 = widgets.Accordion(children=[accordion_content_stats9])\n",
    "accordion_stats9.set_title(0, \"Lien symétrie des pas - pathologie\")\n",
    "\n",
    "accordion_content_stats10 = widgets.VBox([graph_stats17, graph_stats18])\n",
    "accordion_stats10 = widgets.Accordion(children=[accordion_content_stats10])\n",
    "accordion_stats10.set_title(0, \"Lien symétrie des impacts - pathologie\")\n",
    "\n",
    "accordion_content_stats11 = widgets.VBox([graph_stats19, graph_stats20])\n",
    "accordion_stats11 = widgets.Accordion(children=[accordion_content_stats11])\n",
    "accordion_stats11.set_title(0, \"Lien symétrie des amortis - pathologie\")\n",
    "\n",
    "accordion_content_stats12 = widgets.VBox([graph_stats21, graph_stats22])\n",
    "accordion_stats12 = widgets.Accordion(children=[accordion_content_stats12])\n",
    "accordion_stats12.set_title(0, \"Lien symétrie du bassin - pathologie\")\n",
    "\n",
    "accordion_content_stats13 = widgets.VBox([graph_stats23, graph_stats24])\n",
    "accordion_stats13 = widgets.Accordion(children=[accordion_content_stats13])\n",
    "accordion_stats13.set_title(0, \"Lien symétrie des hanches - patholologie\")\n",
    "\n",
    "accordion_content_stats14 = widgets.VBox([graph_stats25, graph_stats26])\n",
    "accordion_stats14 = widgets.Accordion(children=[accordion_content_stats14])\n",
    "accordion_stats14.set_title(0, \"Lien symétrie des genoux - pathologie\")\n",
    "\n",
    "accordion_content_stats15 = widgets.VBox([graph_stats27, graph_stats28])\n",
    "accordion_stats15 = widgets.Accordion(children=[accordion_content_stats15])\n",
    "accordion_stats15.set_title(0, \"Lien cadence - foulée\")\n",
    "\n",
    "accordion_content_stats16 = widgets.VBox([graph_stats29, graph_stats30])\n",
    "accordion_stats16 = widgets.Accordion(children=[accordion_content_stats16])\n",
    "accordion_stats16.set_title(0, \"Lien cadence - force d'impact\")\n",
    "\n",
    "accordion_content_stats17 = widgets.VBox([graph_stats31, graph_stats32, graph_stats33])\n",
    "accordion_stats17 = widgets.Accordion(children=[accordion_content_stats17])\n",
    "accordion_stats17.set_title(0, \"Lien foulée - force d'impact\")\n",
    "\n",
    "accordion_content_stats18 = widgets.VBox([graph_stats34])\n",
    "accordion_stats18 = widgets.Accordion(children=[accordion_content_stats18])\n",
    "accordion_stats18.set_title(0, \"Lien flexion genou - force d'impact\")\n",
    "\n",
    "accordion_content_stats19 = widgets.VBox([graph_stats35, graph_stats36])\n",
    "accordion_stats19 = widgets.Accordion(children=[accordion_content_stats19])\n",
    "accordion_stats19.set_title(0, \"Lien flexion genou - foulée\")\n",
    "\n",
    "\n",
    "tab9_content = widgets.VBox([accordion_stats1, accordion_stats2, accordion_stats3, accordion_stats4, accordion_stats5, accordion_stats6,\n",
    "                             accordion_stats7, accordion_stats8, accordion_stats9, accordion_stats10, accordion_stats11, accordion_stats12,\n",
    "                            accordion_stats13, accordion_stats14, accordion_stats15, accordion_stats16, accordion_stats17, accordion_stats18,\n",
    "                            accordion_stats19])\n",
    "\n",
    "# Tab correlation\n",
    "\n",
    "html_content_correlation1 = widgets.HTML(value=\"<h3> Général </h3>\")\n",
    "html_content_correlation2 = widgets.HTML(value=\"<h3> Marche </h3>\")\n",
    "html_content_correlation3 = widgets.HTML(value=\"<h3> Course à pied </h3>\")\n",
    "\n",
    "dataset_ml_walk_row = widgets.Label(f\"Nombre de lignes : {len(dataset_ml_walk)}\")\n",
    "dataset_ml_run_row = widgets.Label(f\"Nombre de lignes : {len(dataset_ml_run)}\")\n",
    "\n",
    "accordion_content_correlation1=widgets.VBox([html_content_correlation1, graph_correlation1, correlation1, html_content_correlation2, dataset_ml_walk_row,\n",
    "                                             graph_correlation2, correlation2, html_content_correlation3, dataset_ml_run_row, graph_correlation3, correlation3])\n",
    "accordion_correlation1=widgets.Accordion(children=[accordion_content_correlation1])\n",
    "accordion_correlation1.set_title(0, \"Corrélations\")\n",
    "\n",
    "tab10_content = widgets.VBox([accordion_correlation1])\n",
    "\n",
    "# Tab ML\n",
    "\n",
    "html_content_ML1 = widgets.HTML(value =\"<h3> Régression logistique</h3>\")\n",
    "html_content_ML2 = widgets.HTML(value =\"<h3> Random forest</h3>\")\n",
    "\n",
    "accordion_content_ml1=widgets.VBox([dataset_ml_walk_row, ml1, html_content_ML1, ml3, html_content_ML2, ml5, ml6])\n",
    "accordion_ml1=widgets.Accordion(children=[accordion_content_ml1])\n",
    "accordion_ml1.set_title(0, \"Prédiction de la pathologie (marche)\")\n",
    "\n",
    "accordion_content_ml2=widgets.VBox([dataset_ml_run_row, ml2, html_content_ML1, ml4, html_content_ML2, ml7, ml8])\n",
    "accordion_ml2=widgets.Accordion(children=[accordion_content_ml2])\n",
    "accordion_ml2.set_title(0, \"Prédiction de la pathologie (course à pied)\")\n",
    "\n",
    "tab11_content = widgets.VBox([accordion_ml1, accordion_ml2])\n",
    "\n",
    "# Tab about\n",
    "html_content_about1= widgets.HTML(value=\"<h2>A propos des données</h2>\")\n",
    "html_content_about2= widgets.HTML(value=\"<p>Les exports Excel sont téléchargés dans le même dossier que le fichier où se trouve le tableau de bord.</p>\")\n",
    "html_content_about3= widgets.HTML(value=\"<h3>Jeu de données non nettoyé</h3>\")\n",
    "dataset_without_cleaning_row = widgets.Label(f\"Nombre de lignes : {len(dataset_without_cleaning)}\")\n",
    "dataset_without_cleaning_columns = widgets.Label(f\"Nombre de colonnes : {len(dataset_without_cleaning.columns)}\")\n",
    "html_content_about4= widgets.HTML(value=\"<h3>Jeu de données nettoyé</h3>\")\n",
    "dataset_cleaned_row = widgets.Label(f\"Nombre de lignes : {len(dataset_cleaned)}\")\n",
    "dataset_cleaned_columns = widgets.Label(f\"Nombre de colonnes : {len(dataset_cleaned.columns)}\")\n",
    "html_content_about5= widgets.HTML(value= '''<ul>\n",
    "    <li>suppression des lignes en doublon le cas échéant</li>\n",
    "    <li>suppression des colonnes non pertinentes pour l’analyse de données</li>\n",
    "    <li>suppression des lignes correspondant à une session enregistrée avant le 1/06/2024 (données tests)</li>\n",
    "    <li>suppression des lignes dont le « id_trainer » vaut 1 ou 2 ou compris entre 34 et 44 (profils tests)</li>\n",
    "    <li>suppression des lignes où noms et/ou prénoms valent \"test\" ou \"moi\"\n",
    "    <li>suppression des lignes où la pathologie est \"Test\", \"Test2\", ou \"Marche\"\n",
    "    <li>suppression des lignes où cadence > 250 pas/min ou longueur de foulée <0 (erreur de mesure des capteurs)</li>\n",
    "    <li>seules les lignes où isref=1 sont conservées (première séance)</li>\n",
    "    <li>standardisation de la région du corps \"Dos/bassin\"</li>\n",
    "    <li>harminisation des régions du corps et pathologies, suppression des lignes en cas de valeurs aberrantes</li>\n",
    "    <li>ajout d'une colonne avec la pathologie et la région du corps</li>\n",
    "    <li>correction de la distance et de la durée</li>\n",
    "    <li>ajout de la cadence et vitesse théorique</li>\n",
    "    <li>correction des amortis (60Hz au lieu de 100Hz)</li> \n",
    "</ul>''')\n",
    "\n",
    "html_content_about6= widgets.HTML(value=\"<p>Le nombre de lignes étant réduit, les choix suivants ont été faits (mais à termes ces lignes pourront être suppprimées):</p>\")\n",
    "html_content_about7= widgets.HTML(value= '''<ul>\n",
    "    <li>les tailles <100 cm et >230 cm sont remplacés par la moyenne de l'échantillon selon le fait d'être adulte ou enfant et le sexe, idem pour les poids <15 kg et >150kg</li>\n",
    "    <li>les âges <5 ans et >100 ans sont remplacés par la moyenne de l'échantillon\n",
    "    <li>si l'amorti ou la force d'impact vaut 0 pour un côté, alors la valeur du côté opposé la remplace (la valeur à droite et gauche sont donc identiques)</li>\n",
    "    <li>même manipulation pour la longueur de pas</li>\n",
    "</ul>''')\n",
    "\n",
    "html_content_about8=widgets.HTML(value=\"<p>Les colonnes pour les calculs des symétries sont ajoutées par la suite</p>\")\n",
    "\n",
    "tab12_content = widgets.VBox([version, html_content_about1, html_content_about2, html_content_about3, dataset_without_cleaning_row, dataset_without_cleaning_columns, \n",
    "                              html_content_about4, dataset_cleaned_row, dataset_cleaned_columns, html_content_about5, html_content_about6, \n",
    "                              html_content_about7, html_content_about8])\n",
    "\n",
    "\n",
    "\n",
    "# Dashboard creation with tabs\n",
    "tabs = widgets.Tab(children=[tab0_content, tab1_content, tab2_content, tab3_content, tab4_content, tab5_content, tab6_content, \n",
    "                             tab7_content, tab8_content, tab9_content, tab10_content, tab11_content, tab12_content])\n",
    "\n",
    "# Tabs title\n",
    "tabs.set_title(0, \"Praticiens\")\n",
    "tabs.set_title(1, \"Patients\")\n",
    "tabs.set_title(2, \"Diagnostics\")\n",
    "tabs.set_title(3, \"Sessions\")\n",
    "tabs.set_title(4, \"Cinétiques\")\n",
    "tabs.set_title(5, \"Spatiotemporels\")\n",
    "tabs.set_title(6, \"Bassin\")\n",
    "tabs.set_title(7, \"Hanches\")\n",
    "tabs.set_title(8, \"Genoux\")\n",
    "tabs.set_title(9, \"Statistiques\")\n",
    "tabs.set_title(10, \"Corrélations\")\n",
    "tabs.set_title(11, \"ML\")\n",
    "tabs.set_title(12, \"A propos de\")\n",
    "\n",
    "# Display dashboard\n",
    "display(tabs)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3.12",
   "language": "python",
   "name": "python312"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.6"
  },
  "widgets": {
   "application/vnd.jupyter.widget-state+json": {
    "state": {},
    "version_major": 2,
    "version_minor": 0
   }
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
